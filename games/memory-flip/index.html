<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<title>ğŸƒ Memory Flip â€” East Sea Games</title>
<meta name="description" content="Memory Flip - Match pairs of cards! Test your memory with cute emoji cards. 3 difficulty levels, combos, and timer!">
<link rel="canonical" href="https://eastsea.monster/games/memory-flip/">
<meta property="og:title" content="ğŸƒ Memory Flip â€” East Sea Games">
<meta property="og:description" content="ì¹´ë“œë¥¼ ë’¤ì§‘ì–´ ê°™ì€ ì§ì„ ì°¾ìœ¼ì„¸ìš”! ê·€ì—¬ìš´ ì´ëª¨ì§€ ì¹´ë“œë¡œ ê¸°ì–µë ¥ ë„ì „! ì½¤ë³´ ë³´ë„ˆìŠ¤ì™€ íƒ€ì´ë¨¸!">
<meta property="og:image" content="https://eastsea.monster/games/memory-flip/og.png">
<meta property="og:url" content="https://eastsea.monster/games/memory-flip/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="East Sea Games">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="ğŸƒ Memory Flip â€” East Sea Games">
<meta name="twitter:description" content="Match pairs of cards! Cute emoji memory game with combos and timer.">
<meta name="twitter:image" content="https://eastsea.monster/games/memory-flip/og.png">
<link rel="manifest" href="/games/manifest.json">
<meta name="theme-color" content="#1a1a2e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="/games/icons/icon-192.png">
<script type="application/ld+json">
{
  "@context":"https://schema.org","@type":"VideoGame","name":"Memory Flip",
  "url":"https://eastsea.monster/games/memory-flip/",
  "description":"Match pairs of cards! Cute emoji memory card game with combos and timer.",
  "image":"https://eastsea.monster/games/memory-flip/og.png",
  "gamePlatform":["Web Browser","Mobile Browser"],"applicationCategory":"Game",
  "genre":"Puzzle","operatingSystem":"Any","inLanguage":["ko","en"],"playMode":"SinglePlayer",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD","availability":"https://schema.org/InStock"},
  "author":{"@type":"Person","name":"Jay Lee","url":"https://eastsea.monster"}
}
</script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESET & BASE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;
  background:var(--tg-bg,#1a1a2e);color:var(--tg-text,#fff);
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  touch-action:manipulation;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}

:root{
  --safe-top:0px;--safe-bottom:0px;--safe-left:0px;--safe-right:0px;
  --tg-viewport-height:100vh;
  --tg-bg:#1a1a2e;--tg-text:#fff;--tg-hint:#999;
  --tg-button:#3390ec;--tg-button-text:#fff;--tg-secondary-bg:#16213e;
  --card-flip-time:0.5s;
  --accent:#e94560;--accent-glow:rgba(233,69,96,0.4);
  --gold:#FFD700;--combo-color:#4ecdc4;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{width:100%;height:var(--tg-viewport-height,100vh);display:flex;flex-direction:column;
  align-items:center;position:relative;overflow:hidden}

.screen{display:none;width:100%;max-width:500px;height:100%;flex-direction:column;
  align-items:center;padding:12px 16px;position:relative}
.screen.active{display:flex}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-menu{justify-content:center;gap:10px;text-align:center}
.logo{font-size:80px;line-height:1;margin-bottom:4px;
  filter:drop-shadow(0 4px 24px rgba(233,69,96,0.5));animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0) rotate(0deg)}
  25%{transform:translateY(-8px) rotate(2deg)}
  75%{transform:translateY(4px) rotate(-1deg)}}

#screen-menu h1{font-size:2rem;font-weight:800;letter-spacing:-0.5px;
  background:linear-gradient(135deg,var(--accent),#ff6b9d);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{color:var(--tg-hint,#999);font-size:0.9rem;margin-bottom:12px}

.difficulty-selector{display:flex;gap:8px;width:100%;max-width:320px;margin-bottom:12px}
.diff-btn{flex:1;padding:12px 8px;border:2px solid rgba(255,255,255,0.1);border-radius:12px;
  background:rgba(255,255,255,0.05);color:var(--tg-text,#fff);font-size:0.8rem;font-weight:600;
  cursor:pointer;transition:all 0.2s;text-align:center;display:flex;flex-direction:column;gap:2px}
.diff-btn:active{transform:scale(0.95)}
.diff-btn.selected{border-color:var(--accent);background:rgba(233,69,96,0.15);
  box-shadow:0 0 16px var(--accent-glow)}
.diff-label{font-size:0.7rem;color:var(--tg-hint,#888)}

.menu-buttons{display:flex;flex-direction:column;gap:8px;width:100%;max-width:260px}
.menu-stats{display:flex;gap:16px;justify-content:center;margin-top:10px;
  font-size:0.85rem;color:var(--tg-hint,#aaa)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{padding:14px 28px;border:none;border-radius:14px;font-size:1rem;font-weight:600;
  cursor:pointer;transition:transform 0.15s,opacity 0.15s;
  display:flex;align-items:center;justify-content:center;gap:6px;min-height:48px}
.btn:active{transform:scale(0.95);opacity:0.85}
.btn-primary{background:linear-gradient(135deg,var(--accent),#ff6b9d);color:#fff;
  box-shadow:0 4px 16px var(--accent-glow)}
.btn-secondary{background:rgba(255,255,255,0.1);color:var(--tg-text,#fff);
  border:1px solid rgba(255,255,255,0.15)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME HUD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-game{gap:0}
.game-hud{display:flex;align-items:center;width:100%;gap:6px;padding:4px 0 8px;flex-shrink:0}
.hud-item{display:flex;flex-direction:column;align-items:center;flex:1;
  background:rgba(255,255,255,0.06);border-radius:10px;padding:6px 4px}
.hud-label{font-size:0.65rem;color:var(--tg-hint,#888);text-transform:uppercase;letter-spacing:1px}
.hud-value{font-size:1.1rem;font-weight:800;line-height:1.2}
.hud-value.timer{color:var(--accent)}
.hud-value.moves{color:var(--gold)}
.hud-value.combo{color:var(--combo-color)}
.hud-back{width:36px;height:36px;border:none;border-radius:10px;
  background:rgba(255,255,255,0.08);color:var(--tg-text,#fff);font-size:1.2rem;
  cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.hud-back:active{transform:scale(0.9)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CARD GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card-grid{flex:1;display:grid;gap:6px;width:100%;padding:4px 0;
  align-content:center;justify-items:center}
.card-grid.cols-4{grid-template-columns:repeat(4,1fr)}
.card-grid.cols-6{grid-template-columns:repeat(6,1fr)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 3D CARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{position:relative;width:100%;aspect-ratio:1;perspective:600px;cursor:pointer;
  -webkit-tap-highlight-color:transparent}
.card-inner{position:absolute;inset:0;transition:transform var(--card-flip-time) cubic-bezier(0.4,0,0.2,1);
  transform-style:preserve-3d}
.card.flipped .card-inner{transform:rotateY(180deg)}
.card.matched .card-inner{transform:rotateY(180deg)}

.card-face{position:absolute;inset:0;border-radius:12px;display:flex;align-items:center;
  justify-content:center;backface-visibility:hidden;-webkit-backface-visibility:hidden;
  font-size:2rem;border:2px solid rgba(255,255,255,0.1)}

.card-back{background:linear-gradient(135deg,#2a2a4a,#1e1e3a);
  box-shadow:inset 0 0 20px rgba(233,69,96,0.1),0 2px 8px rgba(0,0,0,0.3)}
.card-back::after{content:'â“';font-size:1.4rem;opacity:0.5}
.card-back .card-pattern{position:absolute;inset:4px;border-radius:8px;
  border:2px dashed rgba(233,69,96,0.2)}

.card-front{background:linear-gradient(135deg,#2d2d5e,#1a1a3e);transform:rotateY(180deg);
  box-shadow:inset 0 0 20px rgba(78,205,196,0.1),0 2px 8px rgba(0,0,0,0.3)}

/* Card States */
.card.flipped .card-face.card-back{pointer-events:none}
.card.matched{animation:matchPop 0.5s ease;pointer-events:none}
.card.matched .card-front{background:linear-gradient(135deg,#1a4a3a,#0d3a2a);
  border-color:rgba(78,205,196,0.4);box-shadow:0 0 16px rgba(78,205,196,0.3)}
.card.wrong .card-front{animation:shake 0.4s ease}
.card.hint-glow .card-back{animation:hintPulse 0.6s ease}

@keyframes matchPop{
  0%{transform:scale(1)}30%{transform:scale(1.15)}60%{transform:scale(0.95)}100%{transform:scale(1)}}
@keyframes shake{
  0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}
  60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
@keyframes hintPulse{
  0%,100%{box-shadow:inset 0 0 20px rgba(233,69,96,0.1)}
  50%{box-shadow:inset 0 0 30px rgba(233,69,96,0.4),0 0 12px var(--accent-glow)}}

/* Card size adjustments */
.card-grid.cols-6 .card-face{border-radius:8px;font-size:1.4rem}
.card-grid.cols-6 .card-back::after{font-size:1rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COMBO POPUP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.combo-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
  font-size:2rem;font-weight:900;color:var(--combo-color);text-shadow:0 2px 20px rgba(78,205,196,0.6);
  pointer-events:none;z-index:100;white-space:nowrap;opacity:0}
.combo-popup.show{animation:comboIn 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards}
@keyframes comboIn{
  0%{transform:translate(-50%,-50%) scale(0);opacity:0}
  30%{transform:translate(-50%,-50%) scale(1.3);opacity:1}
  100%{transform:translate(-50%,-70%) scale(1);opacity:0}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PARTICLES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.particle{position:fixed;pointer-events:none;z-index:200;font-size:1.2rem;
  animation:particleFly 0.8s ease-out forwards}
@keyframes particleFly{
  0%{opacity:1;transform:translate(0,0) scale(1) rotate(0deg)}
  100%{opacity:0;transform:translate(var(--dx),var(--dy)) scale(0.3) rotate(var(--rot))}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• OVERLAY (Game Over) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{position:absolute;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:8px;z-index:50;opacity:0;pointer-events:none;
  transition:opacity 0.3s ease;padding:20px}
.overlay.show{opacity:1;pointer-events:auto}
.overlay-card{background:var(--tg-secondary-bg,#16213e);border-radius:20px;padding:28px 24px;
  text-align:center;min-width:280px;max-width:340px;width:85%;
  box-shadow:0 20px 60px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.1);
  transform:scale(0.9) translateY(20px);transition:transform 0.3s cubic-bezier(0.34,1.56,0.64,1)}
.overlay.show .overlay-card{transform:scale(1) translateY(0)}

.ov-emoji{font-size:3.5rem;margin-bottom:4px}
.ov-title{font-size:1.4rem;font-weight:800;margin-bottom:2px}
.ov-newbest{color:var(--gold);font-size:0.85rem;font-weight:700;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.ov-score{font-size:3rem;font-weight:900;color:var(--gold);text-shadow:0 2px 10px rgba(0,0,0,0.3);
  line-height:1.1;margin:4px 0}
.ov-score-label{font-size:0.7rem;color:var(--tg-hint,#888);text-transform:uppercase;letter-spacing:2px}
.ov-best{font-size:0.9rem;color:var(--tg-hint,#aaa);margin:4px 0}
.ov-stats{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:8px 0;
  font-size:0.8rem;color:var(--tg-hint,#aaa)}
.ov-buttons{display:flex;gap:10px;margin-top:12px;width:100%}
.ov-buttons .btn{flex:1;font-size:0.9rem;padding:12px 10px;min-height:44px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COUNTDOWN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.countdown{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  z-index:60;pointer-events:none;opacity:0}
.countdown.show{opacity:1}
.countdown-num{font-size:5rem;font-weight:900;color:var(--accent);
  text-shadow:0 0 40px var(--accent-glow);animation:countPop 0.6s ease}
@keyframes countPop{0%{transform:scale(2);opacity:0}40%{transform:scale(0.9);opacity:1}
  100%{transform:scale(1);opacity:1}}
.countdown-text{font-size:1.2rem;font-weight:700;color:var(--tg-hint);margin-top:8px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-height:600px){
  .game-hud{padding:2px 0 4px}
  .hud-item{padding:3px 2px}
  .hud-label{font-size:0.55rem}
  .hud-value{font-size:0.9rem}
  .card-grid{gap:4px}
}
@media(max-width:360px){
  .card-face{font-size:1.6rem;border-radius:8px}
  .card-grid{gap:4px}
  .card-back::after{font-size:1rem}
}
</style>
</head>
<body>
<div id="app">
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen active" id="screen-menu">
    <div class="logo">ğŸƒ</div>
    <h1 data-i18n="title">Memory Flip</h1>
    <div class="subtitle" data-i18n="subtitle">Match the pairs!</div>

    <div class="difficulty-selector" id="diff-sel">
      <button class="diff-btn" data-diff="easy">
        <span>ğŸ˜Š</span><span data-i18n="easy">Easy</span>
        <span class="diff-label">4Ã—3</span>
      </button>
      <button class="diff-btn selected" data-diff="normal">
        <span>ğŸ¤”</span><span data-i18n="normal">Normal</span>
        <span class="diff-label">4Ã—4</span>
      </button>
      <button class="diff-btn" data-diff="hard">
        <span>ğŸ¤¯</span><span data-i18n="hard">Hard</span>
        <span class="diff-label">6Ã—5</span>
      </button>
    </div>

    <div class="menu-buttons">
      <button class="btn btn-primary" id="btn-start">
        <span data-i18n="play">â–¶ Play</span>
      </button>
    </div>

    <div class="menu-stats">
      <span>ğŸ† <span data-i18n="bestLabel">Best</span>: <span id="menu-best">0</span></span>
      <span>ğŸ® <span data-i18n="plays">Plays</span>: <span id="menu-plays">0</span></span>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-game">
    <div class="game-hud">
      <button class="hud-back" id="btn-back">â†</button>
      <div class="hud-item">
        <span class="hud-label" data-i18n="time">TIME</span>
        <span class="hud-value timer" id="hud-timer">0:00</span>
      </div>
      <div class="hud-item">
        <span class="hud-label" data-i18n="moves">MOVES</span>
        <span class="hud-value moves" id="hud-moves">0</span>
      </div>
      <div class="hud-item">
        <span class="hud-label" data-i18n="pairs">PAIRS</span>
        <span class="hud-value" id="hud-pairs">0/6</span>
      </div>
      <div class="hud-item">
        <span class="hud-label" data-i18n="comboLabel">COMBO</span>
        <span class="hud-value combo" id="hud-combo">Ã—1</span>
      </div>
    </div>

    <div class="card-grid cols-4" id="card-grid"></div>

    <!-- Countdown -->
    <div class="countdown" id="countdown">
      <div>
        <div class="countdown-num" id="cd-num">3</div>
        <div class="countdown-text" data-i18n="memorize">Memorize!</div>
      </div>
    </div>

    <!-- Game Over Overlay -->
    <div class="overlay" id="overlay-gameover">
      <div class="overlay-card" id="ov-content"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• tg-sdk-wrapper (inline) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
'use strict';
const TG={
  app:window.Telegram?.WebApp,user:null,isReady:false,_backHandlers:[],
  init(){
    if(!this.app){this.isReady=true;this._injectStandaloneCSS();return false}
    this.app.ready();this.app.expand();
    this.user=this.app.initDataUnsafe?.user||null;
    this._applyTheme();this._setupSafeArea();this._setupBackButton();
    this.app.onEvent('viewportChanged',({isStateStable})=>{if(isStateStable)this._updateViewport()});
    this.app.onEvent('themeChanged',()=>this._applyTheme());
    this.isReady=true;return true;
  },
  _applyTheme(){
    const tp=this.app?.themeParams;if(!tp)return;
    const r=document.documentElement.style;
    const m={'--tg-bg':tp.bg_color,'--tg-text':tp.text_color,'--tg-hint':tp.hint_color,
      '--tg-link':tp.link_color,'--tg-button':tp.button_color,'--tg-button-text':tp.button_text_color,
      '--tg-secondary-bg':tp.secondary_bg_color};
    for(const[p,v]of Object.entries(m)){if(v)r.setProperty(p,v)}
  },
  _setupSafeArea(){
    this._applySafeAreaValues();
    if(this.app?.onEvent){
      this.app.onEvent('safeAreaChanged',()=>this._applySafeAreaValues());
      this.app.onEvent('contentSafeAreaChanged',()=>this._applySafeAreaValues());
    }
    this._updateViewport();
  },
  _applySafeAreaValues(){
    const r=document.documentElement.style;
    const sa=this.app?.safeAreaInset||{top:0,bottom:0,left:0,right:0};
    const csa=this.app?.contentSafeAreaInset||{top:0,bottom:0,left:0,right:0};
    const totalTop=sa.top+csa.top,totalBottom=sa.bottom+csa.bottom;
    r.setProperty('--safe-top',totalTop+'px');r.setProperty('--safe-bottom',totalBottom+'px');
    r.setProperty('--safe-left',sa.left+'px');r.setProperty('--safe-right',sa.right+'px');
    document.body.style.paddingTop=totalTop+'px';document.body.style.paddingBottom=totalBottom+'px';
  },
  _updateViewport(){
    const vh=this.app?.viewportStableHeight||window.innerHeight;
    document.documentElement.style.setProperty('--tg-viewport-height',vh+'px');
  },
  _setupBackButton(){
    if(!this.app?.BackButton)return;this.app.BackButton.show();
    this.app.BackButton.onClick(()=>{
      for(let i=this._backHandlers.length-1;i>=0;i--){if(this._backHandlers[i]())return}
      this.app.close();
    });
  },
  _injectStandaloneCSS(){
    const r=document.documentElement.style;
    r.setProperty('--tg-viewport-height',window.innerHeight+'px');
    r.setProperty('--safe-top','0px');r.setProperty('--safe-bottom','0px');
    window.addEventListener('resize',()=>r.setProperty('--tg-viewport-height',window.innerHeight+'px'));
  },
  getUserId(){return this.user?.id||'anonymous'},
  getUserName(){return this.user?.first_name||'Player'},
  getLang(){return this.user?.language_code||'en'},
  isTelegram(){return!!this.app},
  save(k,v){try{const u=this.getUserId();localStorage.setItem(`tg_${u}_${k}`,JSON.stringify(v))}catch{}},
  load(k,fb=null){try{const u=this.getUserId();const r=localStorage.getItem(`tg_${u}_${k}`);return r?JSON.parse(r):fb}catch{return fb}},
  haptic(type='impact',style='medium'){
    if(!this.app?.HapticFeedback)return;
    try{switch(type){
      case'impact':this.app.HapticFeedback.impactOccurred(style);break;
      case'notification':this.app.HapticFeedback.notificationOccurred(style);break;
      case'selection':this.app.HapticFeedback.selectionChanged();break;
    }}catch{}
  },
  shareScore(score,gameName,gameId){
    const text=`ğŸƒ ${gameName}: ${score.toLocaleString()}pts! ğŸ§ `;
    const url=`https://t.me/eastsea_games_bot?startapp=game_${gameId}`;
    if(this.app)this.app.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`);
  },
  onBack(h){this._backHandlers.push(h)},
  offBack(h){this._backHandlers=this._backHandlers.filter(x=>x!==h)}
};

const GameScore={
  save(gid,score){const k=`score_${gid}`;const best=this.getBest(gid);const isNew=score>best;
    if(isNew)TG.save(`${k}_best`,score);
    const h=TG.load(`${k}_history`,[]);h.unshift({score,date:Date.now()});if(h.length>20)h.pop();
    TG.save(`${k}_history`,h);const p=TG.load(`${k}_plays`,0);TG.save(`${k}_plays`,p+1);
    return{isNewBest:isNew,bestScore:isNew?score:best}},
  getBest(gid){return TG.load(`score_${gid}_best`,0)},
  getPlays(gid){return TG.load(`score_${gid}_plays`,0)}
};

window.TG=TG;window.GameScore=GameScore;
function autoInit(){TG.init()}
if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',autoInit);
else autoInit();
})();
</script>

<!-- Cross Promo -->
<script src="/games/cross-promo.js"></script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME LOGIC â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
'use strict';

const GAME_ID = 'memory-flip';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• i18n â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STRINGS = {
  title:      { en:'Memory Flip', ko:'ë©”ëª¨ë¦¬ í”Œë¦½' },
  subtitle:   { en:'Match the pairs!', ko:'ê°™ì€ ì¹´ë“œ ì§ì„ ì°¾ìœ¼ì„¸ìš”!' },
  easy:       { en:'Easy', ko:'ì‰¬ì›€' },
  normal:     { en:'Normal', ko:'ë³´í†µ' },
  hard:       { en:'Hard', ko:'ì–´ë ¤ì›€' },
  play:       { en:'â–¶ Play', ko:'â–¶ ì‹œì‘' },
  bestLabel:  { en:'Best', ko:'ìµœê³ ' },
  plays:      { en:'Plays', ko:'í”Œë ˆì´' },
  time:       { en:'TIME', ko:'ì‹œê°„' },
  moves:      { en:'MOVES', ko:'ì‹œë„' },
  pairs:      { en:'PAIRS', ko:'ì§' },
  comboLabel: { en:'COMBO', ko:'ì½¤ë³´' },
  memorize:   { en:'Memorize!', ko:'ê¸°ì–µí•˜ì„¸ìš”!' },
  gameOver:   { en:'Complete!', ko:'ì™„ë£Œ!' },
  perfect:    { en:'ğŸŒŸ Perfect!', ko:'ğŸŒŸ í¼í™íŠ¸!' },
  newBest:    { en:'ğŸ† New Best!', ko:'ğŸ† ìƒˆ ê¸°ë¡!' },
  score:      { en:'Score', ko:'ì ìˆ˜' },
  best:       { en:'Best', ko:'ìµœê³ ' },
  timeTaken:  { en:'Time', ko:'ì‹œê°„' },
  movesTaken: { en:'Moves', ko:'ì‹œë„' },
  maxCombo:   { en:'Max Combo', ko:'ìµœëŒ€ ì½¤ë³´' },
  replay:     { en:'ğŸ”„ Replay', ko:'ğŸ”„ ë‹¤ì‹œí•˜ê¸°' },
  share:      { en:'ğŸ“¢ Share', ko:'ğŸ“¢ ê³µìœ ' },
  home:       { en:'ğŸ  Home', ko:'ğŸ  í™ˆ' },
  go:         { en:'GO!', ko:'ì‹œì‘!' },
  comboX:     { en:'COMBO', ko:'ì½¤ë³´' },
};

let lang = 'en';
try {
  const tgLang = window.Telegram?.WebApp?.initDataUnsafe?.user?.language_code;
  if (tgLang && tgLang.startsWith('ko')) lang = 'ko';
  else if (navigator.language?.startsWith('ko')) lang = 'ko';
} catch {}

function T(key) { return STRINGS[key]?.[lang] || STRINGS[key]?.en || key; }

function applyI18n() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (STRINGS[key]) el.textContent = T(key);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EMOJI SETS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EMOJI_SETS = {
  animals: ['ğŸ¶','ğŸ±','ğŸ¼','ğŸ¸','ğŸ¦Š','ğŸ°','ğŸ»','ğŸ¨','ğŸ¦','ğŸ®','ğŸ·','ğŸµ','ğŸ”','ğŸ¦„','ğŸ™'],
  food:    ['ğŸ','ğŸ•','ğŸ©','ğŸ£','ğŸ°','ğŸª','ğŸ‰','ğŸ“','ğŸ§','ğŸ”','ğŸŒ®','ğŸŸ','ğŸ¿','ğŸ«','ğŸ¥¨'],
  nature:  ['ğŸŒ¸','ğŸŒº','ğŸŒ»','ğŸŒ·','ğŸ€','ğŸŒˆ','â­','ğŸŒ™','â˜€ï¸','ğŸ”¥','ğŸ’','ğŸ€','ğŸ«§','ğŸ¦‹','ğŸ'],
  travel:  ['ğŸš—','ğŸš€','âœˆï¸','ğŸš¢','ğŸ ','ğŸ–ï¸','ğŸ—»','ğŸŒ‹','ğŸ°','ğŸª','ğŸ¡','ğŸ›¸','ğŸš‚','ğŸ ','â›µ'],
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DIFFICULTY CONFIG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DIFFICULTIES = {
  easy:   { cols:4, rows:3, pairs:6,  peekTime:3000, timeBonus:200, moveBonus:15 },
  normal: { cols:4, rows:4, pairs:8,  peekTime:4000, timeBonus:300, moveBonus:20 },
  hard:   { cols:6, rows:5, pairs:15, peekTime:5000, timeBonus:500, moveBonus:30 },
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let difficulty = 'normal';
let cards = [];
let flipped = [];
let matchedPairs = 0;
let totalPairs = 0;
let moves = 0;
let combo = 0;
let maxCombo = 0;
let score = 0;
let timerStart = 0;
let timerInterval = null;
let elapsedSeconds = 0;
let isLocked = false;
let bestScore = 0;
let gameActive = false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DOM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const $menuScreen = document.getElementById('screen-menu');
const $gameScreen = document.getElementById('screen-game');
const $grid = document.getElementById('card-grid');
const $hudTimer = document.getElementById('hud-timer');
const $hudMoves = document.getElementById('hud-moves');
const $hudPairs = document.getElementById('hud-pairs');
const $hudCombo = document.getElementById('hud-combo');
const $btnStart = document.getElementById('btn-start');
const $btnBack = document.getElementById('btn-back');
const $diffSel = document.getElementById('diff-sel');
const $menuBest = document.getElementById('menu-best');
const $menuPlays = document.getElementById('menu-plays');
const $countdown = document.getElementById('countdown');
const $cdNum = document.getElementById('cd-num');
const $overlay = document.getElementById('overlay-gameover');
const $ovContent = document.getElementById('ov-content');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SHUFFLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUILD CARDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildCards() {
  const cfg = DIFFICULTIES[difficulty];
  totalPairs = cfg.pairs;

  // Pick random emoji set then pick pairs
  const setKeys = Object.keys(EMOJI_SETS);
  const setKey = setKeys[Math.floor(Math.random() * setKeys.length)];
  let pool = [...EMOJI_SETS[setKey]];
  // If we need more, mix in other sets
  if (pool.length < cfg.pairs) {
    for (const k of setKeys) {
      if (k !== setKey) pool.push(...EMOJI_SETS[k]);
      if (pool.length >= cfg.pairs) break;
    }
  }
  shuffle(pool);
  const selected = pool.slice(0, cfg.pairs);

  // Create pairs
  cards = [];
  selected.forEach((emoji, idx) => {
    cards.push({ id: idx * 2,     pairId: idx, emoji });
    cards.push({ id: idx * 2 + 1, pairId: idx, emoji });
  });
  shuffle(cards);

  // Update grid CSS
  $grid.className = `card-grid cols-${cfg.cols}`;

  // Render
  $grid.innerHTML = '';
  cards.forEach((card, i) => {
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.idx = i;
    el.innerHTML = `
      <div class="card-inner">
        <div class="card-face card-back"><div class="card-pattern"></div></div>
        <div class="card-face card-front">${card.emoji}</div>
      </div>`;
    $grid.appendChild(el);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TIMER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startTimer() {
  timerStart = Date.now();
  elapsedSeconds = 0;
  $hudTimer.textContent = '0:00';
  timerInterval = setInterval(() => {
    elapsedSeconds = Math.floor((Date.now() - timerStart) / 1000);
    const m = Math.floor(elapsedSeconds / 60);
    const s = elapsedSeconds % 60;
    $hudTimer.textContent = `${m}:${s.toString().padStart(2, '0')}`;
  }, 200);
}

function stopTimer() {
  if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCORE CALC â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function calcScore() {
  const cfg = DIFFICULTIES[difficulty];
  const basePairScore = 100;
  // Time bonus: less time = more bonus
  const timePenalty = elapsedSeconds * 2;
  // Move efficiency
  const perfectMoves = totalPairs; // minimum possible moves (pairs)
  const moveEfficiency = Math.max(0, cfg.moveBonus - (moves - perfectMoves));
  // Combo bonus accumulated during play
  const timeBonus = Math.max(0, cfg.timeBonus - timePenalty);
  
  return Math.max(0, (totalPairs * basePairScore) + timeBonus + (moveEfficiency * 10) + score);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CARD TAP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleCardTap(idx) {
  if (isLocked || !gameActive) return;
  const cardEl = $grid.children[idx];
  if (!cardEl || cardEl.classList.contains('flipped') || cardEl.classList.contains('matched')) return;

  // Flip
  cardEl.classList.add('flipped');
  flipped.push(idx);
  TG.haptic('impact', 'light');

  if (flipped.length === 2) {
    moves++;
    $hudMoves.textContent = moves;
    isLocked = true;

    const [a, b] = flipped;
    const cardA = cards[a];
    const cardB = cards[b];

    if (cardA.pairId === cardB.pairId) {
      // âœ… Match!
      combo++;
      if (combo > maxCombo) maxCombo = combo;
      matchedPairs++;
      
      // Combo score bonus
      const comboBonus = combo > 1 ? (combo - 1) * 25 : 0;
      score += comboBonus;

      $hudPairs.textContent = `${matchedPairs}/${totalPairs}`;
      $hudCombo.textContent = `Ã—${combo}`;

      setTimeout(() => {
        $grid.children[a].classList.add('matched');
        $grid.children[b].classList.add('matched');
        TG.haptic('notification', 'success');
        spawnParticles($grid.children[a]);
        spawnParticles($grid.children[b]);
        
        if (combo > 1) showComboPopup(combo);

        flipped = [];
        isLocked = false;

        // Check win
        if (matchedPairs === totalPairs) {
          setTimeout(() => gameComplete(), 400);
        }
      }, 300);
    } else {
      // âŒ No match
      combo = 0;
      $hudCombo.textContent = 'Ã—1';

      setTimeout(() => {
        $grid.children[a].classList.add('wrong');
        $grid.children[b].classList.add('wrong');
        TG.haptic('notification', 'error');
      }, 300);

      setTimeout(() => {
        $grid.children[a].classList.remove('flipped', 'wrong');
        $grid.children[b].classList.remove('flipped', 'wrong');
        flipped = [];
        isLocked = false;
      }, 900);
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PARTICLES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function spawnParticles(el) {
  const rect = el.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  const emojis = ['âœ¨','â­','ğŸ’«','ğŸŒŸ','ğŸ‰'];

  for (let i = 0; i < 6; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    p.style.left = cx + 'px';
    p.style.top = cy + 'px';
    const angle = (Math.PI * 2 * i) / 6 + Math.random() * 0.5;
    const dist = 40 + Math.random() * 50;
    p.style.setProperty('--dx', Math.cos(angle) * dist + 'px');
    p.style.setProperty('--dy', Math.sin(angle) * dist + 'px');
    p.style.setProperty('--rot', (Math.random() * 360) + 'deg');
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 800);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COMBO POPUP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showComboPopup(c) {
  const el = document.createElement('div');
  el.className = 'combo-popup show';
  el.textContent = `ğŸ”¥ ${T('comboX')} Ã—${c}!`;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 900);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PEEK PHASE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function peekPhase() {
  return new Promise(resolve => {
    const cfg = DIFFICULTIES[difficulty];
    
    // Show all cards briefly
    Array.from($grid.children).forEach(c => c.classList.add('flipped'));

    // Countdown
    $countdown.classList.add('show');
    const peekSec = Math.ceil(cfg.peekTime / 1000);
    let remaining = peekSec;
    $cdNum.textContent = remaining;

    const interval = setInterval(() => {
      remaining--;
      if (remaining > 0) {
        $cdNum.textContent = remaining;
        TG.haptic('impact', 'light');
      } else {
        clearInterval(interval);
        $cdNum.textContent = T('go');
        TG.haptic('impact', 'heavy');
        
        setTimeout(() => {
          // Hide all cards
          Array.from($grid.children).forEach(c => c.classList.remove('flipped'));
          $countdown.classList.remove('show');
          resolve();
        }, 600);
      }
    }, 1000);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• START GAME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startGame() {
  // Reset state
  cards = [];
  flipped = [];
  matchedPairs = 0;
  moves = 0;
  combo = 0;
  maxCombo = 0;
  score = 0;
  isLocked = true;
  gameActive = false;
  $overlay.classList.remove('show');

  showScreen('screen-game');
  buildCards();

  // Update HUD
  $hudTimer.textContent = '0:00';
  $hudMoves.textContent = '0';
  $hudPairs.textContent = `0/${totalPairs}`;
  $hudCombo.textContent = 'Ã—1';

  // Peek phase
  await peekPhase();

  // Start game
  gameActive = true;
  isLocked = false;
  startTimer();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME COMPLETE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gameComplete() {
  gameActive = false;
  stopTimer();

  const finalScore = calcScore();
  const isPerfect = moves === totalPairs; // All first-try matches
  const result = GameScore.save(GAME_ID + '_' + difficulty, finalScore);
  bestScore = result.bestScore;

  TG.haptic('notification', result.isNewBest ? 'success' : 'warning');

  // Build overlay
  const m = Math.floor(elapsedSeconds / 60);
  const s = elapsedSeconds % 60;
  const timeStr = `${m}:${s.toString().padStart(2, '0')}`;

  $ovContent.innerHTML = `
    <div class="ov-emoji">${result.isNewBest ? 'ğŸ†' : isPerfect ? 'ğŸŒŸ' : 'ğŸ‰'}</div>
    <div class="ov-title">${T('gameOver')}</div>
    ${isPerfect ? `<div class="ov-newbest">${T('perfect')}</div>` : ''}
    ${result.isNewBest ? `<div class="ov-newbest">${T('newBest')}</div>` : ''}
    <div class="ov-score">${finalScore.toLocaleString()}</div>
    <div class="ov-score-label">${T('score')}</div>
    <div class="ov-best">ğŸ… ${T('best')}: ${bestScore.toLocaleString()}</div>
    <div class="ov-stats">
      <span>â± ${T('timeTaken')}: ${timeStr}</span>
      <span>ğŸ‘† ${T('movesTaken')}: ${moves}</span>
      <span>ğŸ”¥ ${T('maxCombo')}: Ã—${maxCombo}</span>
    </div>
    <div class="ov-buttons">
      <button class="btn btn-primary" id="ov-replay">${T('replay')}</button>
      <button class="btn btn-secondary" id="ov-share">${T('share')}</button>
    </div>
    <div class="ov-buttons" style="margin-top:6px">
      <button class="btn btn-secondary" id="ov-home">${T('home')}</button>
    </div>
  `;

  setTimeout(() => $overlay.classList.add('show'), 300);

  // Event listeners
  document.getElementById('ov-replay').addEventListener('click', () => startGame());
  document.getElementById('ov-share').addEventListener('click', () => {
    TG.shareScore(finalScore, 'Memory Flip', GAME_ID);
  });
  document.getElementById('ov-home').addEventListener('click', () => goHome());
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goHome() {
  stopTimer();
  gameActive = false;
  $overlay.classList.remove('show');
  updateMenuStats();
  showScreen('screen-menu');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MENU STATS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateMenuStats() {
  const best = GameScore.getBest(GAME_ID + '_' + difficulty);
  const plays = GameScore.getPlays(GAME_ID + '_' + difficulty);
  $menuBest.textContent = best.toLocaleString();
  $menuPlays.textContent = plays;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INPUT SETUP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setupInput() {
  // Touch events
  $grid.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const touch = e.changedTouches[0];
    const el = document.elementFromPoint(touch.clientX, touch.clientY);
    if (!el) return;
    const card = el.closest('.card');
    if (card) handleCardTap(parseInt(card.dataset.idx));
  }, { passive: false });

  // Mouse fallback
  $grid.addEventListener('click', (e) => {
    const card = e.target.closest('.card');
    if (card) handleCardTap(parseInt(card.dataset.idx));
  });

  // Prevent context menu
  $grid.addEventListener('contextmenu', e => e.preventDefault());
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DIFFICULTY SELECT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setupDifficultySelect() {
  $diffSel.addEventListener('click', (e) => {
    const btn = e.target.closest('.diff-btn');
    if (!btn) return;
    TG.haptic('selection');
    difficulty = btn.dataset.diff;
    $diffSel.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    updateMenuStats();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init() {
  applyI18n();
  setupInput();
  setupDifficultySelect();
  updateMenuStats();

  // Start button
  $btnStart.addEventListener('click', () => {
    TG.haptic('impact', 'medium');
    startGame();
  });

  // Back button
  $btnBack.addEventListener('click', () => {
    TG.haptic('impact', 'light');
    goHome();
  });

  // TG back button
  TG.onBack(() => {
    if (document.getElementById('screen-game').classList.contains('active')) {
      goHome();
      return true;
    }
    return false;
  });
}

// Auto-init
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}

})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Ball Sort Puzzle</title>
<meta property="og:title" content="Ball Sort Puzzle">
<meta property="og:type" content="website">
<meta property="og:url" content="https://eastsea.monster/games/ball-sort/">
<meta property="og:description" content="Play Ball Sort - Free HTML5 game. No download required!">
<meta property="og:site_name" content="East Sea Games">
<meta name="description" content="Play Ball Sort - Free HTML5 browser game. No download, no install.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ball Sort Puzzle">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        
        .header {
            width: 100%;
            max-width: 500px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        
        .level-info {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            width: 100%;
            max-width: 500px;
        }
        
        .tubes-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            max-width: 100%;
        }
        
        .tube {
            display: flex;
            flex-direction: column-reverse;
            width: 50px;
            height: 180px;
            background: rgba(255,255,255,0.15);
            border: 3px solid rgba(255,255,255,0.4);
            border-top: none;
            border-radius: 0 0 25px 25px;
            padding: 5px;
            gap: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .tube:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .tube.selected {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .tube.shake {
            animation: shake 0.3s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 
                inset -8px -8px 15px rgba(0,0,0,0.2),
                inset 5px 5px 10px rgba(255,255,255,0.4),
                0 4px 8px rgba(0,0,0,0.2);
        }
        
        .ball.moving {
            position: absolute;
            z-index: 100;
        }
        
        .ball.color-0 { background: linear-gradient(135deg, #ff6b6b, #ee5a5a); }
        .ball.color-1 { background: linear-gradient(135deg, #4ecdc4, #3dbdb5); }
        .ball.color-2 { background: linear-gradient(135deg, #ffe66d, #ffd93d); }
        .ball.color-3 { background: linear-gradient(135deg, #95e1d3, #7dd3c4); }
        .ball.color-4 { background: linear-gradient(135deg, #a8e6cf, #8fd9bc); }
        .ball.color-5 { background: linear-gradient(135deg, #dda0dd, #cc8fcc); }
        .ball.color-6 { background: linear-gradient(135deg, #87ceeb, #6bbfdf); }
        .ball.color-7 { background: linear-gradient(135deg, #ffa07a, #f58b64); }
        
        .footer {
            width: 100%;
            max-width: 500px;
            padding: 15px 20px;
            text-align: center;
            color: rgba(255,255,255,0.7);
        }
        
        .moves {
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
        }
        
        .modal h2 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .stars {
            font-size: 2.5em;
            margin: 15px 0;
        }
        
        .modal-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .modal-btn:hover {
            transform: scale(1.05);
        }
    </style>
    <!-- Telegram Mini App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/games/tg-sdk-wrapper.js?v=1769736738"></script>
</head>
<body>
    <div class="header">
        <div class="level-info">Level <span id="levelNum">1</span></div>
        <div class="controls">
            <button class="btn" id="undoBtn" title="Undo">‚Ü©Ô∏è</button>
            <button class="btn" id="hintBtn" title="Hint">üí°</button>
            <button class="btn" id="restartBtn" title="Restart">üîÑ</button>
        </div>
    </div>
    
    <div class="game-area">
        <div class="tubes-container" id="tubesContainer"></div>
    </div>
    
    <div class="footer">
        <div class="moves">Moves: <span id="moveCount">0</span></div>
    </div>
    
    <div class="modal" id="winModal">
        <div class="modal-content">
            <h2>üéâ Level Complete!</h2>
            <div class="stars" id="starsDisplay">‚≠ê‚≠ê‚≠ê</div>
            <p id="moveResult"></p>
            <button class="modal-btn" id="nextLevelBtn">Next Level</button>
        </div>
    </div>
    
    <script>
        const TUBE_CAPACITY = 4;
        const COLORS = ['color-0', 'color-1', 'color-2', 'color-3', 'color-4', 'color-5', 'color-6', 'color-7'];
        
        let level = parseInt(localStorage.getItem('ballSortLevel') || '1');
        let tubes = [];
        let selectedTube = null;
        let moveHistory = [];
        let moveCount = 0;
        let isAnimating = false;
        
        function getColorCount(lvl) {
            if (lvl <= 10) return 4;
            if (lvl <= 30) return 5;
            if (lvl <= 60) return 6;
            if (lvl <= 100) return 7;
            return 8;
        }
        
        function getTargetMoves(lvl) {
            if (lvl <= 10) return 15;
            if (lvl <= 30) return 20;
            if (lvl <= 60) return 28;
            if (lvl <= 100) return 35;
            return 45;
        }
        
        function generateLevel() {
            const colorCount = getColorCount(level);
            const emptyTubes = 2;
            const totalTubes = colorCount + emptyTubes;
            
            // Create balls - 4 of each color
            let balls = [];
            for (let c = 0; c < colorCount; c++) {
                for (let i = 0; i < 4; i++) {
                    balls.push(c);
                }
            }
            
            // Shuffle
            for (let i = balls.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [balls[i], balls[j]] = [balls[j], balls[i]];
            }
            
            // Distribute to tubes
            tubes = [];
            for (let t = 0; t < colorCount; t++) {
                tubes.push(balls.slice(t * 4, (t + 1) * 4));
            }
            
            // Add empty tubes
            for (let t = 0; t < emptyTubes; t++) {
                tubes.push([]);
            }
            
            moveHistory = [];
            moveCount = 0;
            selectedTube = null;
        }
        
        function render() {
            const container = document.getElementById('tubesContainer');
            container.innerHTML = '';
            
            tubes.forEach((tube, i) => {
                const tubeEl = document.createElement('div');
                tubeEl.className = 'tube' + (selectedTube === i ? ' selected' : '');
                tubeEl.onclick = () => handleTubeClick(i);
                
                tube.forEach((color, j) => {
                    const ball = document.createElement('div');
                    ball.className = `ball ${COLORS[color]}`;
                    tubeEl.appendChild(ball);
                });
                
                container.appendChild(tubeEl);
            });
            
            document.getElementById('levelNum').textContent = level;
            document.getElementById('moveCount').textContent = moveCount;
            document.getElementById('undoBtn').disabled = moveHistory.length === 0;
        }
        
        function canMove(fromTube, toTube) {
            if (tubes[fromTube].length === 0) return false;
            if (tubes[toTube].length >= TUBE_CAPACITY) return false;
            if (tubes[toTube].length === 0) return true;
            
            const fromTop = tubes[fromTube][tubes[fromTube].length - 1];
            const toTop = tubes[toTube][tubes[toTube].length - 1];
            return fromTop === toTop;
        }
        
        function moveBall(from, to, isUndo = false) {
            if (isAnimating) return;
            
            const ball = tubes[from].pop();
            tubes[to].push(ball);
            
            if (!isUndo) {
                moveHistory.push({ from, to });
                moveCount++;
            }
            
            render();
            checkWin();
        }
        
        function handleTubeClick(index) {
            if (isAnimating) return;
            
            if (selectedTube === null) {
                if (tubes[index].length > 0) {
                    selectedTube = index;
                    render();
                }
            } else {
                if (selectedTube === index) {
                    selectedTube = null;
                    render();
                } else if (canMove(selectedTube, index)) {
                    const from = selectedTube;
                    selectedTube = null;
                    moveBall(from, index);
                } else {
                    // Shake animation
                    const tubeEls = document.querySelectorAll('.tube');
                    tubeEls[index].classList.add('shake');
                    setTimeout(() => tubeEls[index].classList.remove('shake'), 300);
                }
            }
        }
        
        function checkWin() {
            const isComplete = tubes.every(tube => {
                if (tube.length === 0) return true;
                if (tube.length !== TUBE_CAPACITY) return false;
                return tube.every(ball => ball === tube[0]);
            });
            
            if (isComplete) {
                showWinModal();
            }
        }
        
        function showWinModal() {
            const target = getTargetMoves(level);
            let stars = 1;
            if (moveCount <= target) stars = 3;
            else if (moveCount <= target * 1.5) stars = 2;
            
            document.getElementById('starsDisplay').textContent = '‚≠ê'.repeat(stars) + '‚òÜ'.repeat(3 - stars);
            document.getElementById('moveResult').textContent = `Completed in ${moveCount} moves!`;
            document.getElementById('winModal').classList.add('show');
        }
        
        function nextLevel() {
            level++;
            localStorage.setItem('ballSortLevel', level);
            document.getElementById('winModal').classList.remove('show');
            generateLevel();
            render();
        }
        
        function undo() {
            if (moveHistory.length === 0) return;
            const lastMove = moveHistory.pop();
            const ball = tubes[lastMove.to].pop();
            tubes[lastMove.from].push(ball);
            moveCount--;
            selectedTube = null;
            render();
        }
        
        function restart() {
            generateLevel();
            render();
        }
        
        function showHint() {
            // Simple hint: find a valid move
            for (let from = 0; from < tubes.length; from++) {
                for (let to = 0; to < tubes.length; to++) {
                    if (from !== to && canMove(from, to)) {
                        selectedTube = from;
                        render();
                        return;
                    }
                }
            }
        }
        
        // Event listeners
        document.getElementById('undoBtn').onclick = undo;
        document.getElementById('restartBtn').onclick = restart;
        document.getElementById('hintBtn').onclick = showHint;
        document.getElementById('nextLevelBtn').onclick = nextLevel;
        
        // Initialize
        generateLevel();
        render();
    </script>
</body>
</html>

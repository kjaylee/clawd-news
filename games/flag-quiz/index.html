<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<title>ğŸ³ï¸ Flag Quiz â€” East Sea Games</title>
<meta name="description" content="Flag Quiz - Can you name the country from its flag? 50+ countries, 4 choices, streak bonuses!">
<link rel="canonical" href="https://eastsea.monster/games/flag-quiz/">
<meta property="og:title" content="ğŸ³ï¸ Flag Quiz â€” East Sea Games">
<meta property="og:description" content="êµ­ê¸° í€´ì¦ˆ! êµ­ê¸°ë¥¼ ë³´ê³  ë‚˜ë¼ë¥¼ ë§í˜€ë³´ì„¸ìš”. 50ê°œêµ­ ì´ìƒ, ì—°ì† ì •ë‹µ ë³´ë„ˆìŠ¤!">
<meta property="og:image" content="https://eastsea.monster/games/flag-quiz/og.png">
<meta property="og:url" content="https://eastsea.monster/games/flag-quiz/">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<link rel="manifest" href="/games/manifest.json">
<meta name="theme-color" content="#1565c0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script type="application/ld+json">
{
  "@context":"https://schema.org","@type":"VideoGame","name":"Flag Quiz",
  "url":"https://eastsea.monster/games/flag-quiz/",
  "description":"Can you name the country from its flag? Test your knowledge with 50+ countries!",
  "image":"https://eastsea.monster/games/flag-quiz/og.png",
  "gamePlatform":["Web Browser","Mobile Browser"],"applicationCategory":"Game",
  "genre":"Quiz","operatingSystem":"Any","inLanguage":["ko","en"],"playMode":"SinglePlayer",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD","availability":"https://schema.org/InStock"},
  "author":{"@type":"Person","name":"Jay Lee","url":"https://eastsea.monster"}
}
</script>

<!-- Telegram Mini App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESET & BASE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;
  background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 30%,#90caf9 60%,#64b5f6 100%);
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  touch-action:manipulation;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}

:root{
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
  --safe-left:env(safe-area-inset-left,0px);
  --safe-right:env(safe-area-inset-right,0px);
  --tg-bg:#e3f2fd;--tg-text:#1a237e;--tg-hint:#5c6bc0;
  --tg-button:#1565c0;--tg-button-text:#fff;--tg-secondary-bg:#bbdefb;
  --primary:#1565c0;--primary-light:#42a5f5;--primary-dark:#0d47a1;
  --correct:#2e7d32;--correct-bg:#c8e6c9;--correct-light:#66bb6a;
  --wrong:#c62828;--wrong-bg:#ffcdd2;--wrong-light:#ef5350;
  --gold:#f9a825;--card-bg:rgba(255,255,255,0.95);--shadow:0 4px 20px rgba(0,0,0,0.12);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME CONTAINER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game{display:flex;flex-direction:column;align-items:center;
  width:100%;height:100%;position:relative;
  padding:var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
  overflow:hidden}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HUD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hud{width:100%;max-width:420px;display:flex;justify-content:space-between;align-items:center;
  padding:8px 16px;margin-top:4px;gap:8px;flex-shrink:0}
.hud-item{display:flex;flex-direction:column;align-items:center;min-width:50px}
.hud-label{font-size:10px;font-weight:700;letter-spacing:0.5px;color:var(--tg-hint);text-transform:uppercase}
.hud-value{font-size:20px;font-weight:900;color:var(--primary-dark)}
.hud-progress{flex:1;height:6px;background:rgba(255,255,255,0.6);border-radius:3px;overflow:hidden;
  margin:0 4px;min-width:60px;max-width:180px}
.hud-progress-bar{height:100%;background:linear-gradient(90deg,var(--primary-light),var(--primary));
  border-radius:3px;transition:width 0.4s ease}
.streak-badge{display:inline-flex;align-items:center;gap:2px;
  background:linear-gradient(135deg,#ff6f00,#ff8f00);color:#fff;
  font-size:11px;font-weight:800;padding:2px 8px;border-radius:10px;
  animation:streakPulse 0.8s ease infinite;min-height:20px}
@keyframes streakPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUESTION AREA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.question-area{flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;width:100%;max-width:420px;padding:0 16px;gap:12px;min-height:0}

.flag-display{font-size:clamp(80px,20vw,130px);line-height:1.1;text-align:center;
  filter:drop-shadow(0 4px 12px rgba(0,0,0,0.15));
  transition:transform 0.3s ease;padding:8px 0}
.flag-display.bounce{animation:flagBounce 0.5s cubic-bezier(0.34,1.56,0.64,1)}
@keyframes flagBounce{0%{transform:scale(0.3) rotate(-10deg)}50%{transform:scale(1.1) rotate(3deg)}100%{transform:scale(1) rotate(0)}}

.question-text{font-size:16px;font-weight:600;color:var(--primary-dark);text-align:center;
  margin-bottom:4px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHOICES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.choices{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;max-width:400px;padding:0 4px}
.choice-btn{
  background:var(--card-bg);border:2.5px solid rgba(21,101,192,0.15);border-radius:14px;
  padding:14px 10px;font-size:15px;font-weight:600;color:var(--tg-text);
  cursor:pointer;transition:all 0.2s ease;text-align:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.06);min-height:52px;
  display:flex;align-items:center;justify-content:center;line-height:1.2;
  -webkit-tap-highlight-color:transparent;position:relative;overflow:hidden}
.choice-btn:active:not(.disabled){transform:scale(0.96);background:#e8eaf6}
.choice-btn.correct{background:var(--correct-bg)!important;border-color:var(--correct)!important;
  color:var(--correct)!important;animation:correctPop 0.4s ease}
.choice-btn.wrong{background:var(--wrong-bg)!important;border-color:var(--wrong)!important;
  color:var(--wrong)!important;animation:wrongShake 0.4s ease}
.choice-btn.reveal{background:#fff3e0!important;border-color:var(--gold)!important;color:#e65100!important}
.choice-btn.disabled{pointer-events:none;opacity:0.6}
.choice-btn .choice-icon{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:20px}

@keyframes correctPop{0%{transform:scale(1)}30%{transform:scale(1.06)}100%{transform:scale(1)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FEEDBACK OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.feedback{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
  font-size:80px;z-index:100;pointer-events:none;opacity:0}
.feedback.show{animation:feedbackPop 0.7s cubic-bezier(0.34,1.56,0.64,1) forwards}
@keyframes feedbackPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}
  30%{transform:translate(-50%,-50%) scale(1.3);opacity:1}
  60%{transform:translate(-50%,-50%) scale(1);opacity:1}
  100%{transform:translate(-50%,-50%) scale(0.8);opacity:0}}

.streak-popup{position:fixed;top:35%;left:50%;transform:translate(-50%,-50%) scale(0);
  background:linear-gradient(135deg,#ff6f00,#ff8f00);color:#fff;
  font-size:18px;font-weight:800;padding:8px 20px;border-radius:16px;
  z-index:101;pointer-events:none;white-space:nowrap;
  box-shadow:0 4px 20px rgba(255,111,0,0.4)}
.streak-popup.show{animation:streakFly 1s cubic-bezier(0.34,1.56,0.64,1) forwards}
@keyframes streakFly{0%{transform:translate(-50%,-50%) scale(0);opacity:0}
  20%{transform:translate(-50%,-50%) scale(1.2);opacity:1}
  50%{transform:translate(-50%,-50%) scale(1);opacity:1}
  100%{transform:translate(-50%,-80%) scale(0.8);opacity:0}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONFETTI â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.confetti-container{position:fixed;inset:0;pointer-events:none;z-index:99;overflow:hidden}
.confetti-piece{position:absolute;width:10px;height:10px;top:-10px;border-radius:2px;
  animation:confettiFall linear forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg);opacity:1}
  100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREENS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;
  justify-content:center;padding:20px;transition:opacity 0.3s,transform 0.3s;
  padding-top:calc(var(--safe-top) + 20px);padding-bottom:calc(var(--safe-bottom) + 20px)}
.screen.hidden{opacity:0;pointer-events:none;transform:scale(0.95)}

/* â”€â”€ Menu Screen â”€â”€ */
.menu-icon{font-size:80px;margin-bottom:8px;filter:drop-shadow(0 4px 12px rgba(0,0,0,0.15))}
.menu-title{font-size:32px;font-weight:900;color:var(--primary-dark);margin-bottom:4px;text-align:center}
.menu-subtitle{font-size:15px;color:var(--tg-hint);margin-bottom:16px;text-align:center}
.menu-stats{display:flex;gap:20px;margin-bottom:20px}
.menu-stat{display:flex;flex-direction:column;align-items:center;
  background:var(--card-bg);border-radius:14px;padding:12px 18px;box-shadow:var(--shadow)}
.menu-stat-value{font-size:24px;font-weight:800;color:var(--primary)}
.menu-stat-label{font-size:11px;font-weight:600;color:var(--tg-hint);text-transform:uppercase}

.btn{border:none;border-radius:14px;font-size:17px;font-weight:700;
  cursor:pointer;padding:15px 40px;transition:all 0.2s;min-width:200px;min-height:52px}
.btn:active{transform:scale(0.96)}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-light));
  color:#fff;box-shadow:0 4px 15px rgba(21,101,192,0.35)}
.btn-secondary{background:var(--card-bg);color:var(--primary);
  border:2px solid rgba(21,101,192,0.2);box-shadow:var(--shadow);margin-top:10px}

/* â”€â”€ Result Screen â”€â”€ */
.result-emoji{font-size:64px;margin-bottom:8px}
.result-title{font-size:28px;font-weight:900;color:var(--primary-dark);margin-bottom:4px}
.result-score{font-size:48px;font-weight:900;color:var(--primary);margin:4px 0}
.result-detail{font-size:14px;color:var(--tg-hint);margin-bottom:4px;text-align:center;line-height:1.6}
.result-newbest{font-size:16px;font-weight:800;color:var(--gold);
  animation:streakPulse 0.8s ease infinite;margin-bottom:8px}
.result-bar{width:80%;max-width:300px;height:10px;background:rgba(255,255,255,0.6);
  border-radius:5px;overflow:hidden;margin:8px 0 16px}
.result-bar-fill{height:100%;border-radius:5px;transition:width 1s ease}
.result-buttons{display:flex;flex-direction:column;gap:8px;align-items:center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-height:600px){
  .flag-display{font-size:70px;padding:4px 0}
  .choice-btn{padding:10px 8px;font-size:14px;min-height:44px}
  .choices{gap:8px}
  .question-area{gap:6px}
  .hud{padding:4px 12px}
}
@media(max-height:500px){
  .flag-display{font-size:56px}
  .choice-btn{padding:8px 6px;font-size:13px;min-height:38px}
  .menu-icon{font-size:50px}
  .menu-title{font-size:24px}
}
@media(min-width:500px){
  .choices{max-width:420px}
  .choice-btn{font-size:16px;padding:16px 12px}
}
</style>
</head>
<body>

<!-- tg-sdk-wrapper (inline) -->
<script>
(function(){
'use strict';
const TG={
  app:window.Telegram?.WebApp,user:null,isReady:false,_backHandlers:[],
  init(){
    if(!this.app){this.isReady=true;this._injectStandaloneCSS();return false}
    this.app.ready();this.app.expand();
    this.user=this.app.initDataUnsafe?.user||null;
    this._applyTheme();this._setupSafeArea();this._setupBackButton();
    this.app.onEvent('viewportChanged',({isStateStable})=>{if(isStateStable)this._updateViewport()});
    this.app.onEvent('themeChanged',()=>this._applyTheme());
    this.isReady=true;return true;
  },
  _applyTheme(){
    const tp=this.app?.themeParams;if(!tp)return;
    const r=document.documentElement.style;
    const m={'--tg-bg':tp.bg_color,'--tg-text':tp.text_color,'--tg-hint':tp.hint_color,
      '--tg-link':tp.link_color,'--tg-button':tp.button_color,'--tg-button-text':tp.button_text_color,
      '--tg-secondary-bg':tp.secondary_bg_color};
    for(const[p,v]of Object.entries(m)){if(v)r.setProperty(p,v)}
  },
  _setupSafeArea(){
    this._applySafeAreaValues();
    if(this.app?.onEvent){
      this.app.onEvent('safeAreaChanged',()=>this._applySafeAreaValues());
      this.app.onEvent('contentSafeAreaChanged',()=>this._applySafeAreaValues());
    }
    this._updateViewport();
  },
  _applySafeAreaValues(){
    const r=document.documentElement.style;
    const sa=this.app?.safeAreaInset||{top:0,bottom:0,left:0,right:0};
    const csa=this.app?.contentSafeAreaInset||{top:0,bottom:0,left:0,right:0};
    const totalTop=sa.top+csa.top,totalBottom=sa.bottom+csa.bottom;
    r.setProperty('--safe-top',totalTop+'px');r.setProperty('--safe-bottom',totalBottom+'px');
    r.setProperty('--safe-left',sa.left+'px');r.setProperty('--safe-right',sa.right+'px');
    document.body.style.paddingTop=totalTop+'px';document.body.style.paddingBottom=totalBottom+'px';
  },
  _updateViewport(){
    const vh=this.app?.viewportStableHeight||window.innerHeight;
    document.documentElement.style.setProperty('--tg-viewport-height',vh+'px');
  },
  _setupBackButton(){
    if(!this.app?.BackButton)return;this.app.BackButton.show();
    this.app.BackButton.onClick(()=>{
      for(let i=this._backHandlers.length-1;i>=0;i--){if(this._backHandlers[i]())return}
      this.app.close();
    });
  },
  _injectStandaloneCSS(){
    const s=document.createElement('style');
    s.textContent='body{background:linear-gradient(135deg,#e3f2fd,#bbdefb,#90caf9);color:#1a237e}';
    document.head.appendChild(s);
  },
  onBack(fn){this._backHandlers.push(fn)},
  getUserId(){return this.user?.id||'guest'},
  getUserName(){return this.user?.first_name||'Player'},
  getLang(){return this.user?.language_code||'en'},
  haptic(type='impact',style='medium'){
    try{
      if(type==='impact')this.app?.HapticFeedback?.impactOccurred(style);
      else if(type==='notification')this.app?.HapticFeedback?.notificationOccurred(style);
      else if(type==='selection')this.app?.HapticFeedback?.selectionChanged();
    }catch{}
  },
  share(text,url){
    if(this.app){
      const shareUrl=url||window.location.href;
      this.app.openTelegramLink('https://t.me/share/url?url='+encodeURIComponent(shareUrl)+'&text='+encodeURIComponent(text));
    }
  },
  save(key,value){try{localStorage.setItem('tg_'+this.getUserId()+'_'+key,JSON.stringify(value))}catch{}},
  load(key,fb=null){try{const r=localStorage.getItem('tg_'+this.getUserId()+'_'+key);return r?JSON.parse(r):fb}catch{return fb}},
};
function autoInit(){TG.init()}
if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',autoInit);
else autoInit();
window.TG=TG;
})();
</script>

<div id="game">
  <!-- â•â•â• HUD (shown during gameplay) â•â•â• -->
  <div class="hud" id="hud" style="display:none">
    <div class="hud-item">
      <span class="hud-label" data-i18n="question">Q</span>
      <span class="hud-value" id="hud-qnum">1/10</span>
    </div>
    <div class="hud-progress">
      <div class="hud-progress-bar" id="hud-progress" style="width:10%"></div>
    </div>
    <div class="hud-item">
      <span class="hud-label" data-i18n="score">SCORE</span>
      <span class="hud-value" id="hud-score">0</span>
    </div>
    <div class="hud-item" id="hud-streak-wrap" style="display:none">
      <span class="streak-badge" id="hud-streak">ğŸ”¥ 0</span>
    </div>
  </div>

  <!-- â•â•â• Question Area â•â•â• -->
  <div class="question-area" id="question-area" style="display:none">
    <div class="flag-display" id="flag-display">ğŸ‡°ğŸ‡·</div>
    <div class="question-text" data-i18n="whichCountry">Which country's flag is this?</div>
    <div class="choices" id="choices"></div>
  </div>

  <!-- â•â•â• Menu Screen â•â•â• -->
  <div class="screen" id="screen-menu">
    <div class="menu-icon">ğŸ³ï¸â€ğŸŒˆ</div>
    <div class="menu-title" data-i18n="title">Flag Quiz</div>
    <div class="menu-subtitle" data-i18n="subtitle">Can you name the country?</div>
    <div class="menu-stats">
      <div class="menu-stat">
        <span class="menu-stat-value" id="menu-best">0</span>
        <span class="menu-stat-label" data-i18n="bestScore">Best</span>
      </div>
      <div class="menu-stat">
        <span class="menu-stat-value" id="menu-plays">0</span>
        <span class="menu-stat-label" data-i18n="gamesPlayed">Played</span>
      </div>
      <div class="menu-stat">
        <span class="menu-stat-value" id="menu-accuracy">0%</span>
        <span class="menu-stat-label" data-i18n="accuracy">Accuracy</span>
      </div>
    </div>
    <button class="btn btn-primary" id="btn-start" data-i18n="startBtn">ğŸŒ Start Quiz</button>
  </div>

  <!-- â•â•â• Result Screen â•â•â• -->
  <div class="screen hidden" id="screen-result">
    <div class="result-emoji" id="result-emoji">ğŸ†</div>
    <div class="result-title" data-i18n="roundComplete">Round Complete!</div>
    <div class="result-newbest hidden" id="result-newbest" data-i18n="newBest">ğŸ† New Best Score!</div>
    <div class="result-score" id="result-score">0</div>
    <div class="result-detail" id="result-detail"></div>
    <div class="result-bar"><div class="result-bar-fill" id="result-bar-fill"></div></div>
    <div class="result-buttons">
      <button class="btn btn-primary" id="btn-replay" data-i18n="playAgain">ğŸ”„ Play Again</button>
      <button class="btn btn-secondary" id="btn-share" data-i18n="shareScore">ğŸ“¢ Share Score</button>
    </div>
  </div>

  <!-- â•â•â• Feedback â•â•â• -->
  <div class="feedback" id="feedback"></div>
  <div class="streak-popup" id="streak-popup"></div>
  <div class="confetti-container" id="confetti"></div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Flag Quiz â€” Game Logic
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
'use strict';

// â”€â”€ i18n â”€â”€
const STRINGS = {
  title:         { en: 'Flag Quiz',               ko: 'êµ­ê¸° í€´ì¦ˆ' },
  subtitle:      { en: 'Can you name the country?', ko: 'êµ­ê¸°ë¥¼ ë³´ê³  ë‚˜ë¼ë¥¼ ë§í˜€ë³´ì„¸ìš”!' },
  startBtn:      { en: 'ğŸŒ Start Quiz',           ko: 'ğŸŒ í€´ì¦ˆ ì‹œì‘' },
  question:      { en: 'Q',                        ko: 'ë¬¸ì œ' },
  score:         { en: 'SCORE',                    ko: 'ì ìˆ˜' },
  bestScore:     { en: 'Best',                     ko: 'ìµœê³ ' },
  gamesPlayed:   { en: 'Played',                   ko: 'ê²Œì„' },
  accuracy:      { en: 'Accuracy',                 ko: 'ì •ë‹µë¥ ' },
  whichCountry:  { en: "Which country's flag is this?", ko: 'ì–´ëŠ ë‚˜ë¼ì˜ êµ­ê¸°ì¼ê¹Œìš”?' },
  roundComplete: { en: 'Round Complete!',           ko: 'ë¼ìš´ë“œ ì™„ë£Œ!' },
  newBest:       { en: 'ğŸ† New Best Score!',       ko: 'ğŸ† ìƒˆë¡œìš´ ìµœê³  ê¸°ë¡!' },
  playAgain:     { en: 'ğŸ”„ Play Again',            ko: 'ğŸ”„ ë‹¤ì‹œ í•˜ê¸°' },
  shareScore:    { en: 'ğŸ“¢ Share Score',           ko: 'ğŸ“¢ ì ìˆ˜ ê³µìœ ' },
  correct:       { en: 'Correct!',                 ko: 'ì •ë‹µ!' },
  wrong:         { en: 'Wrong!',                   ko: 'ì˜¤ë‹µ!' },
  theAnswer:     { en: 'The answer was',           ko: 'ì •ë‹µì€' },
  streak:        { en: 'streak',                   ko: 'ì—°ì†' },
  perfectRound:  { en: 'ğŸ‰ Perfect Round!',        ko: 'ğŸ‰ í¼í™íŠ¸!' },
  greatJob:      { en: 'ğŸŒŸ Great Job!',            ko: 'ğŸŒŸ ì˜í–ˆì–´ìš”!' },
  goodTry:       { en: 'ğŸ‘ Good Try!',             ko: 'ğŸ‘ ì¢‹ì€ ì‹œë„!' },
  keepLearning:  { en: 'ğŸ“š Keep Learning!',        ko: 'ğŸ“š ê³„ì† ë„ì „!' },
  correctCount:  { en: '{n}/10 correct',           ko: '{n}/10 ì •ë‹µ' },
  bestStreak:    { en: 'Best streak: {n}',         ko: 'ìµœëŒ€ ì—°ì†: {n}' },
  bonusPoints:   { en: '+{n} streak bonus!',       ko: '+{n} ì—°ì† ë³´ë„ˆìŠ¤!' },
};

let lang = 'en';
{
  const tgLang = window.Telegram?.WebApp?.initDataUnsafe?.user?.language_code;
  if (tgLang && tgLang.startsWith('ko')) lang = 'ko';
  else if (navigator.language?.startsWith('ko')) lang = 'ko';
}

function t(key, params) {
  let s = STRINGS[key]?.[lang] || STRINGS[key]?.en || key;
  if (params) { for (const [k,v] of Object.entries(params)) s = s.replace(`{${k}}`, v); }
  return s;
}

function applyI18n() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    const s = STRINGS[key]?.[lang] || STRINGS[key]?.en;
    if (s) el.textContent = s;
  });
}

// â”€â”€ Country Data: {emoji, en, ko} â”€â”€
const COUNTRIES = [
  // East Asia
  { flag: 'ğŸ‡°ğŸ‡·', en: 'South Korea',      ko: 'ëŒ€í•œë¯¼êµ­' },
  { flag: 'ğŸ‡¯ğŸ‡µ', en: 'Japan',             ko: 'ì¼ë³¸' },
  { flag: 'ğŸ‡¨ğŸ‡³', en: 'China',             ko: 'ì¤‘êµ­' },
  { flag: 'ğŸ‡¹ğŸ‡¼', en: 'Taiwan',            ko: 'ëŒ€ë§Œ' },
  { flag: 'ğŸ‡²ğŸ‡³', en: 'Mongolia',          ko: 'ëª½ê³¨' },
  // Southeast Asia
  { flag: 'ğŸ‡¹ğŸ‡­', en: 'Thailand',          ko: 'íƒœêµ­' },
  { flag: 'ğŸ‡»ğŸ‡³', en: 'Vietnam',           ko: 'ë² íŠ¸ë‚¨' },
  { flag: 'ğŸ‡µğŸ‡­', en: 'Philippines',       ko: 'í•„ë¦¬í•€' },
  { flag: 'ğŸ‡®ğŸ‡©', en: 'Indonesia',         ko: 'ì¸ë„ë„¤ì‹œì•„' },
  { flag: 'ğŸ‡²ğŸ‡¾', en: 'Malaysia',          ko: 'ë§ë ˆì´ì‹œì•„' },
  { flag: 'ğŸ‡¸ğŸ‡¬', en: 'Singapore',         ko: 'ì‹±ê°€í¬ë¥´' },
  { flag: 'ğŸ‡²ğŸ‡²', en: 'Myanmar',           ko: 'ë¯¸ì–€ë§ˆ' },
  { flag: 'ğŸ‡°ğŸ‡­', en: 'Cambodia',          ko: 'ìº„ë³´ë””ì•„' },
  { flag: 'ğŸ‡±ğŸ‡¦', en: 'Laos',              ko: 'ë¼ì˜¤ìŠ¤' },
  // South Asia
  { flag: 'ğŸ‡®ğŸ‡³', en: 'India',             ko: 'ì¸ë„' },
  { flag: 'ğŸ‡µğŸ‡°', en: 'Pakistan',          ko: 'íŒŒí‚¤ìŠ¤íƒ„' },
  { flag: 'ğŸ‡§ğŸ‡©', en: 'Bangladesh',        ko: 'ë°©ê¸€ë¼ë°ì‹œ' },
  { flag: 'ğŸ‡±ğŸ‡°', en: 'Sri Lanka',         ko: 'ìŠ¤ë¦¬ë‘ì¹´' },
  { flag: 'ğŸ‡³ğŸ‡µ', en: 'Nepal',             ko: 'ë„¤íŒ”' },
  // Middle East
  { flag: 'ğŸ‡¸ğŸ‡¦', en: 'Saudi Arabia',      ko: 'ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„' },
  { flag: 'ğŸ‡¦ğŸ‡ª', en: 'UAE',               ko: 'ì•„ëì—ë¯¸ë¦¬íŠ¸' },
  { flag: 'ğŸ‡®ğŸ‡±', en: 'Israel',            ko: 'ì´ìŠ¤ë¼ì—˜' },
  { flag: 'ğŸ‡¹ğŸ‡·', en: 'Turkey',            ko: 'íŠ€ë¥´í‚¤ì˜ˆ' },
  { flag: 'ğŸ‡®ğŸ‡·', en: 'Iran',              ko: 'ì´ë€' },
  { flag: 'ğŸ‡¶ğŸ‡¦', en: 'Qatar',             ko: 'ì¹´íƒ€ë¥´' },
  // Europe
  { flag: 'ğŸ‡¬ğŸ‡§', en: 'United Kingdom',    ko: 'ì˜êµ­' },
  { flag: 'ğŸ‡«ğŸ‡·', en: 'France',            ko: 'í”„ë‘ìŠ¤' },
  { flag: 'ğŸ‡©ğŸ‡ª', en: 'Germany',           ko: 'ë…ì¼' },
  { flag: 'ğŸ‡®ğŸ‡¹', en: 'Italy',             ko: 'ì´íƒˆë¦¬ì•„' },
  { flag: 'ğŸ‡ªğŸ‡¸', en: 'Spain',             ko: 'ìŠ¤í˜ì¸' },
  { flag: 'ğŸ‡µğŸ‡¹', en: 'Portugal',          ko: 'í¬ë¥´íˆ¬ê°ˆ' },
  { flag: 'ğŸ‡³ğŸ‡±', en: 'Netherlands',       ko: 'ë„¤ëœë€ë“œ' },
  { flag: 'ğŸ‡§ğŸ‡ª', en: 'Belgium',           ko: 'ë²¨ê¸°ì—' },
  { flag: 'ğŸ‡¨ğŸ‡­', en: 'Switzerland',       ko: 'ìŠ¤ìœ„ìŠ¤' },
  { flag: 'ğŸ‡¦ğŸ‡¹', en: 'Austria',           ko: 'ì˜¤ìŠ¤íŠ¸ë¦¬ì•„' },
  { flag: 'ğŸ‡¸ğŸ‡ª', en: 'Sweden',            ko: 'ìŠ¤ì›¨ë´' },
  { flag: 'ğŸ‡³ğŸ‡´', en: 'Norway',            ko: 'ë…¸ë¥´ì›¨ì´' },
  { flag: 'ğŸ‡©ğŸ‡°', en: 'Denmark',           ko: 'ë´ë§ˆí¬' },
  { flag: 'ğŸ‡«ğŸ‡®', en: 'Finland',           ko: 'í•€ë€ë“œ' },
  { flag: 'ğŸ‡µğŸ‡±', en: 'Poland',            ko: 'í´ë€ë“œ' },
  { flag: 'ğŸ‡¬ğŸ‡·', en: 'Greece',            ko: 'ê·¸ë¦¬ìŠ¤' },
  { flag: 'ğŸ‡·ğŸ‡º', en: 'Russia',            ko: 'ëŸ¬ì‹œì•„' },
  { flag: 'ğŸ‡ºğŸ‡¦', en: 'Ukraine',           ko: 'ìš°í¬ë¼ì´ë‚˜' },
  { flag: 'ğŸ‡¨ğŸ‡¿', en: 'Czech Republic',    ko: 'ì²´ì½”' },
  { flag: 'ğŸ‡·ğŸ‡´', en: 'Romania',           ko: 'ë£¨ë§ˆë‹ˆì•„' },
  { flag: 'ğŸ‡­ğŸ‡º', en: 'Hungary',           ko: 'í—ê°€ë¦¬' },
  { flag: 'ğŸ‡®ğŸ‡ª', en: 'Ireland',           ko: 'ì•„ì¼ëœë“œ' },
  { flag: 'ğŸ‡®ğŸ‡¸', en: 'Iceland',           ko: 'ì•„ì´ìŠ¬ë€ë“œ' },
  // Americas
  { flag: 'ğŸ‡ºğŸ‡¸', en: 'United States',     ko: 'ë¯¸êµ­' },
  { flag: 'ğŸ‡¨ğŸ‡¦', en: 'Canada',            ko: 'ìºë‚˜ë‹¤' },
  { flag: 'ğŸ‡²ğŸ‡½', en: 'Mexico',            ko: 'ë©•ì‹œì½”' },
  { flag: 'ğŸ‡§ğŸ‡·', en: 'Brazil',            ko: 'ë¸Œë¼ì§ˆ' },
  { flag: 'ğŸ‡¦ğŸ‡·', en: 'Argentina',         ko: 'ì•„ë¥´í—¨í‹°ë‚˜' },
  { flag: 'ğŸ‡¨ğŸ‡´', en: 'Colombia',          ko: 'ì½œë¡¬ë¹„ì•„' },
  { flag: 'ğŸ‡¨ğŸ‡±', en: 'Chile',             ko: 'ì¹ ë ˆ' },
  { flag: 'ğŸ‡µğŸ‡ª', en: 'Peru',              ko: 'í˜ë£¨' },
  { flag: 'ğŸ‡¨ğŸ‡º', en: 'Cuba',              ko: 'ì¿ ë°”' },
  { flag: 'ğŸ‡¯ğŸ‡²', en: 'Jamaica',           ko: 'ìë©”ì´ì¹´' },
  // Africa
  { flag: 'ğŸ‡¿ğŸ‡¦', en: 'South Africa',      ko: 'ë‚¨ì•„í”„ë¦¬ì¹´' },
  { flag: 'ğŸ‡ªğŸ‡¬', en: 'Egypt',             ko: 'ì´ì§‘íŠ¸' },
  { flag: 'ğŸ‡³ğŸ‡¬', en: 'Nigeria',           ko: 'ë‚˜ì´ì§€ë¦¬ì•„' },
  { flag: 'ğŸ‡°ğŸ‡ª', en: 'Kenya',             ko: 'ì¼€ëƒ' },
  { flag: 'ğŸ‡ªğŸ‡¹', en: 'Ethiopia',          ko: 'ì—í‹°ì˜¤í”¼ì•„' },
  { flag: 'ğŸ‡²ğŸ‡¦', en: 'Morocco',           ko: 'ëª¨ë¡œì½”' },
  { flag: 'ğŸ‡¬ğŸ‡­', en: 'Ghana',             ko: 'ê°€ë‚˜' },
  // Oceania
  { flag: 'ğŸ‡¦ğŸ‡º', en: 'Australia',         ko: 'í˜¸ì£¼' },
  { flag: 'ğŸ‡³ğŸ‡¿', en: 'New Zealand',       ko: 'ë‰´ì§ˆëœë“œ' },
  // Challenging ones
  { flag: 'ğŸ‡±ğŸ‡®', en: 'Liechtenstein',     ko: 'ë¦¬íˆí…ìŠˆíƒ€ì¸' },
  { flag: 'ğŸ‡±ğŸ‡º', en: 'Luxembourg',        ko: 'ë£©ì…ˆë¶€ë¥´í¬' },
  { flag: 'ğŸ‡§ğŸ‡¹', en: 'Bhutan',            ko: 'ë¶€íƒ„' },
  { flag: 'ğŸ‡²ğŸ‡¨', en: 'Monaco',            ko: 'ëª¨ë‚˜ì½”' },
  { flag: 'ğŸ‡µğŸ‡¦', en: 'Panama',            ko: 'íŒŒë‚˜ë§ˆ' },
  { flag: 'ğŸ‡§ğŸ‡³', en: 'Brunei',            ko: 'ë¸Œë£¨ë‚˜ì´' },
];

// â”€â”€ Game State â”€â”€
const QUESTIONS_PER_ROUND = 10;
const BASE_POINTS = 100;
const STREAK_BONUS = 50;

let state = {
  questions: [],
  currentQ: 0,
  score: 0,
  correctCount: 0,
  streak: 0,
  bestStreak: 0,
  answered: false,
};

// â”€â”€ DOM refs â”€â”€
const $ = id => document.getElementById(id);
const hud = $('hud');
const hudQnum = $('hud-qnum');
const hudProgress = $('hud-progress');
const hudScore = $('hud-score');
const hudStreakWrap = $('hud-streak-wrap');
const hudStreak = $('hud-streak');
const questionArea = $('question-area');
const flagDisplay = $('flag-display');
const choicesEl = $('choices');
const screenMenu = $('screen-menu');
const screenResult = $('screen-result');
const feedbackEl = $('feedback');
const streakPopup = $('streak-popup');
const confettiEl = $('confetti');
const menuBest = $('menu-best');
const menuPlays = $('menu-plays');
const menuAccuracy = $('menu-accuracy');
const resultEmoji = $('result-emoji');
const resultScore = $('result-score');
const resultDetail = $('result-detail');
const resultNewBest = $('result-newbest');
const resultBarFill = $('result-bar-fill');

// â”€â”€ Utility â”€â”€
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function countryName(c) { return c[lang] || c.en; }

// â”€â”€ Stats (localStorage) â”€â”€
function loadStats() {
  return TG.load('flagquiz_stats', { best: 0, plays: 0, totalCorrect: 0, totalQuestions: 0 });
}

function saveStats(stats) {
  TG.save('flagquiz_stats', stats);
}

function updateMenuStats() {
  const stats = loadStats();
  menuBest.textContent = stats.best;
  menuPlays.textContent = stats.plays;
  const pct = stats.totalQuestions > 0 ? Math.round(stats.totalCorrect / stats.totalQuestions * 100) : 0;
  menuAccuracy.textContent = pct + '%';
}

// â”€â”€ Generate Round â”€â”€
function generateRound() {
  const pool = shuffle(COUNTRIES);
  const selected = pool.slice(0, QUESTIONS_PER_ROUND);
  const questions = selected.map(correct => {
    // pick 3 wrong answers (not the same as correct)
    const wrongPool = COUNTRIES.filter(c => c.flag !== correct.flag);
    const wrongs = shuffle(wrongPool).slice(0, 3);
    const options = shuffle([correct, ...wrongs]);
    return { correct, options };
  });
  return questions;
}

// â”€â”€ Show Question â”€â”€
function showQuestion() {
  const q = state.questions[state.currentQ];
  state.answered = false;

  // Update HUD
  hudQnum.textContent = `${state.currentQ + 1}/${QUESTIONS_PER_ROUND}`;
  hudProgress.style.width = `${((state.currentQ + 1) / QUESTIONS_PER_ROUND) * 100}%`;
  hudScore.textContent = state.score;

  // Update streak display
  if (state.streak >= 2) {
    hudStreakWrap.style.display = '';
    hudStreak.textContent = `ğŸ”¥ ${state.streak}`;
  } else {
    hudStreakWrap.style.display = 'none';
  }

  // Flag animation
  flagDisplay.textContent = q.correct.flag;
  flagDisplay.classList.remove('bounce');
  void flagDisplay.offsetWidth;
  flagDisplay.classList.add('bounce');

  // Build choices
  choicesEl.innerHTML = '';
  q.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.textContent = countryName(opt);
    btn.dataset.flag = opt.flag;
    btn.addEventListener('click', () => handleAnswer(btn, opt, q.correct));
    choicesEl.appendChild(btn);
  });
}

// â”€â”€ Handle Answer â”€â”€
function handleAnswer(btn, selected, correct) {
  if (state.answered) return;
  state.answered = true;

  const isCorrect = selected.flag === correct.flag;

  // Disable all buttons
  document.querySelectorAll('.choice-btn').forEach(b => b.classList.add('disabled'));

  if (isCorrect) {
    // Correct!
    btn.classList.add('correct');
    btn.innerHTML = countryName(selected) + '<span class="choice-icon">âœ…</span>';
    state.correctCount++;
    state.streak++;
    if (state.streak > state.bestStreak) state.bestStreak = state.streak;

    // Calculate points
    let points = BASE_POINTS;
    let bonus = 0;
    if (state.streak >= 3) {
      bonus = STREAK_BONUS * (state.streak - 2);
      points += bonus;
    }
    state.score += points;

    showFeedback('âœ…', true);
    TG.haptic('notification', 'success');

    // Streak popup
    if (state.streak >= 3) {
      showStreakPopup(`ğŸ”¥ ${state.streak} ${t('streak')}! +${bonus}`);
    }
  } else {
    // Wrong!
    btn.classList.add('wrong');
    btn.innerHTML = countryName(selected) + '<span class="choice-icon">âŒ</span>';
    state.streak = 0;

    // Reveal correct answer
    document.querySelectorAll('.choice-btn').forEach(b => {
      if (b.dataset.flag === correct.flag) {
        b.classList.add('reveal');
        b.innerHTML = countryName(correct) + '<span class="choice-icon">â­</span>';
      }
    });

    showFeedback('âŒ', false);
    TG.haptic('notification', 'error');
  }

  // Update HUD
  hudScore.textContent = state.score;
  if (state.streak >= 2) {
    hudStreakWrap.style.display = '';
    hudStreak.textContent = `ğŸ”¥ ${state.streak}`;
  } else {
    hudStreakWrap.style.display = 'none';
  }

  // Next question after delay
  const delay = isCorrect ? 1000 : 1800;
  setTimeout(() => {
    state.currentQ++;
    if (state.currentQ < QUESTIONS_PER_ROUND) {
      showQuestion();
    } else {
      endRound();
    }
  }, delay);
}

// â”€â”€ Feedback Animation â”€â”€
function showFeedback(emoji, isCorrect) {
  feedbackEl.textContent = emoji;
  feedbackEl.className = 'feedback';
  void feedbackEl.offsetWidth;
  feedbackEl.classList.add('show');
  setTimeout(() => feedbackEl.classList.remove('show'), 700);

  if (isCorrect && state.streak >= 5) {
    spawnConfetti();
  }
}

function showStreakPopup(text) {
  streakPopup.textContent = text;
  streakPopup.className = 'streak-popup';
  void streakPopup.offsetWidth;
  streakPopup.classList.add('show');
  setTimeout(() => streakPopup.classList.remove('show'), 1000);
}

// â”€â”€ Confetti â”€â”€
function spawnConfetti() {
  confettiEl.innerHTML = '';
  const colors = ['#ff1744','#00e676','#2979ff','#ffd600','#e040fb','#ff9100','#00e5ff'];
  for (let i = 0; i < 30; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + '%';
    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
    piece.style.animationDuration = (1.5 + Math.random() * 2) + 's';
    piece.style.animationDelay = Math.random() * 0.5 + 's';
    piece.style.width = (6 + Math.random() * 8) + 'px';
    piece.style.height = (6 + Math.random() * 8) + 'px';
    confettiEl.appendChild(piece);
  }
  setTimeout(() => confettiEl.innerHTML = '', 4000);
}

// â”€â”€ End Round â”€â”€
function endRound() {
  hud.style.display = 'none';
  questionArea.style.display = 'none';

  // Update stats
  const stats = loadStats();
  const isNewBest = state.score > stats.best;
  if (isNewBest) stats.best = state.score;
  stats.plays++;
  stats.totalCorrect += state.correctCount;
  stats.totalQuestions += QUESTIONS_PER_ROUND;
  saveStats(stats);

  // Result emoji & title
  const pct = state.correctCount / QUESTIONS_PER_ROUND;
  if (pct === 1) {
    resultEmoji.textContent = 'ğŸ‰';
    screenResult.querySelector('.result-title').textContent = t('perfectRound');
    spawnConfetti();
  } else if (pct >= 0.7) {
    resultEmoji.textContent = 'ğŸŒŸ';
    screenResult.querySelector('.result-title').textContent = t('greatJob');
  } else if (pct >= 0.4) {
    resultEmoji.textContent = 'ğŸ‘';
    screenResult.querySelector('.result-title').textContent = t('goodTry');
  } else {
    resultEmoji.textContent = 'ğŸ“š';
    screenResult.querySelector('.result-title').textContent = t('keepLearning');
  }

  resultScore.textContent = state.score;
  resultDetail.innerHTML = `${t('correctCount', {n: state.correctCount})}<br>${t('bestStreak', {n: state.bestStreak})}`;

  if (isNewBest) {
    resultNewBest.classList.remove('hidden');
    TG.haptic('notification', 'success');
  } else {
    resultNewBest.classList.add('hidden');
  }

  // Accuracy bar
  const barColor = pct >= 0.7 ? 'linear-gradient(90deg,#66bb6a,#2e7d32)' :
                   pct >= 0.4 ? 'linear-gradient(90deg,#ffa726,#f57c00)' :
                                'linear-gradient(90deg,#ef5350,#c62828)';
  resultBarFill.style.width = '0%';
  resultBarFill.style.background = barColor;
  setTimeout(() => resultBarFill.style.width = (pct * 100) + '%', 100);

  screenResult.classList.remove('hidden');
}

// â”€â”€ Start Game â”€â”€
function startGame() {
  state = {
    questions: generateRound(),
    currentQ: 0,
    score: 0,
    correctCount: 0,
    streak: 0,
    bestStreak: 0,
    answered: false,
  };

  screenMenu.classList.add('hidden');
  screenResult.classList.add('hidden');
  hud.style.display = 'flex';
  questionArea.style.display = 'flex';

  showQuestion();
}

// â”€â”€ Show Menu â”€â”€
function showMenu() {
  hud.style.display = 'none';
  questionArea.style.display = 'none';
  screenResult.classList.add('hidden');
  screenMenu.classList.remove('hidden');
  updateMenuStats();
}

// â”€â”€ Share â”€â”€
function shareScore() {
  const pct = Math.round(state.correctCount / QUESTIONS_PER_ROUND * 100);
  const text = lang === 'ko'
    ? `ğŸ³ï¸ êµ­ê¸° í€´ì¦ˆì—ì„œ ${state.score}ì  (${pct}% ì •ë‹µ)! ë„ì „í•´ë³´ì„¸ìš”! ğŸ‘‡`
    : `ğŸ³ï¸ I scored ${state.score} (${pct}% correct) in Flag Quiz! Can you beat it? ğŸ‘‡`;
  TG.share(text, 'https://t.me/eastsea_games_bot?startapp=game_flag-quiz');
}

// â”€â”€ Event Listeners â”€â”€
$('btn-start').addEventListener('click', () => { TG.haptic('impact','medium'); startGame(); });
$('btn-replay').addEventListener('click', () => { TG.haptic('impact','medium'); startGame(); });
$('btn-share').addEventListener('click', () => { TG.haptic('impact','light'); shareScore(); });

// Back button
TG.onBack(() => {
  if (!screenMenu.classList.contains('hidden')) return false;
  showMenu();
  return true;
});

// â”€â”€ Init â”€â”€
applyI18n();
updateMenuStats();

})();
</script>

<!-- Cross Promo -->
<script src="/games/cross-promo.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>Color Fill üé®</title>
<meta name="description" content="ÌÑ∞ÏπòÎ°ú Í∑∏Î¶ºÏùÑ ÏÉâÏπ†ÌïòÏÑ∏Ïöî! ÌûêÎßÅ ÏÉâÏπ†ÌïòÍ∏∞ ÌçºÏ¶ê Í≤åÏûÑ.">
<meta property="og:title" content="Color Fill üé® ‚Äî East Sea Games">
<meta property="og:description" content="ÌÑ∞ÏπòÎ°ú Îπà ÏòÅÏó≠ÏùÑ ÏÉâÏπ†ÌïòÏÑ∏Ïöî! ÌûêÎßÅ ÏÉâÏπ† ÌçºÏ¶ê">
<meta property="og:image" content="https://eastsea.monster/games/color-fill/og.png">
<meta property="og:url" content="https://eastsea.monster/games/color-fill/">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<link rel="canonical" href="https://eastsea.monster/games/color-fill/">
<link rel="manifest" href="/games/manifest.json">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"VideoGame","name":"Color Fill",
"url":"https://eastsea.monster/games/color-fill/",
"description":"ÌÑ∞ÏπòÎ°ú Îπà ÏòÅÏó≠ÏùÑ ÏÉâÏπ†ÌïòÏÑ∏Ïöî! ÌûêÎßÅ ÏÉâÏπ† ÌçºÏ¶ê",
"gamePlatform":["Web Browser","Mobile Browser"],"applicationCategory":"Game",
"genre":"Casual","operatingSystem":"Any","inLanguage":["ko","en","ja"],
"offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
"author":{"@type":"Person","name":"Jay Lee","url":"https://eastsea.monster"}}
</script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:#1a1a2e;color:#e0e0e0;user-select:none}
:root{--bg:#1a1a2e;--card:#16213e;--accent:#e94560;--safe-top:0px;--safe-bottom:0px}
body{display:flex;flex-direction:column;align-items:center;padding-top:var(--safe-top);padding-bottom:var(--safe-bottom)}
#app{width:100%;max-width:420px;height:100%;display:flex;flex-direction:column}
.header{display:flex;justify-content:space-between;align-items:center;padding:8px 16px}
.title{font-size:18px;font-weight:700;color:var(--accent)}
.hdr-info{display:flex;gap:12px;align-items:center}
.score-box{text-align:center}
.score-label{font-size:9px;opacity:0.6;text-transform:uppercase}
.score-value{font-size:16px;font-weight:800;color:#fff}
.progress-bar{height:6px;margin:0 16px 4px;border-radius:3px;background:rgba(255,255,255,0.1);overflow:hidden}
.progress-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,#e94560,#ff6b9d);transition:width 0.3s;width:0%}
.canvas-wrap{flex:1;display:flex;align-items:center;justify-content:center;padding:8px}
canvas{border-radius:12px;touch-action:none;box-shadow:0 4px 20px rgba(0,0,0,0.4)}
.palette{display:flex;gap:6px;padding:8px 12px;justify-content:center;flex-wrap:wrap}
.pal-btn{width:38px;height:38px;border-radius:50%;border:3px solid transparent;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 6px rgba(0,0,0,0.3)}
.pal-btn.active{border-color:#fff;transform:scale(1.2);box-shadow:0 0 12px rgba(255,255,255,0.3)}
.tools{display:flex;gap:8px;padding:4px 12px 12px;justify-content:center}
.tool-btn{padding:8px 16px;border:none;border-radius:8px;font-size:13px;cursor:pointer;background:rgba(255,255,255,0.1);color:#fff;transition:all 0.15s;min-height:36px}
.tool-btn:active{transform:scale(0.95)}
.tool-btn.active{background:var(--accent)}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(6px)}
.modal{background:var(--card);border-radius:20px;padding:28px 24px;text-align:center;width:min(85vw,320px);border:1px solid rgba(255,255,255,0.1)}
.modal h2{font-size:24px;color:var(--accent);margin-bottom:8px}
.modal .big{font-size:48px;font-weight:800;color:#fff;margin:12px 0}
.modal .sub{font-size:14px;opacity:0.7;margin-bottom:16px}
.btn{padding:14px 24px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;width:100%;margin-top:8px;min-height:48px}
.btn:active{transform:scale(0.95)}
.btn-primary{background:var(--accent);color:#fff}
.btn-secondary{background:rgba(255,255,255,0.1);color:#fff}
</style>
</head>
<body>
<div id="app">
<div class="header">
<div class="title">üé® Color Fill</div>
<div class="hdr-info">
<div class="score-box"><div class="score-label" data-i18n="level">LEVEL</div><div class="score-value" id="levelVal">1</div></div>
<div class="score-box"><div class="score-label" data-i18n="filled">FILLED</div><div class="score-value" id="pctVal">0%</div></div>
</div>
</div>
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
<div class="canvas-wrap"><canvas id="canvas"></canvas></div>
<div class="palette" id="palette"></div>
<div class="tools">
<button class="tool-btn active" id="brushBtn">üñåÔ∏è Brush</button>
<button class="tool-btn" id="fillBtn">ü™£ Fill</button>
<button class="tool-btn" id="undoBtn">‚Ü©</button>
<button class="tool-btn" id="nextBtn">‚è≠</button>
</div>
</div>
<div class="modal-bg" id="modalBg" style="display:none">
<div class="modal">
<h2 id="modalTitle"></h2>
<div class="big" id="modalScore"></div>
<div class="sub" id="modalSub"></div>
<button class="btn btn-primary" id="modalNext" data-i18n="nextLevel">Next Level</button>
</div>
</div>
<script src="/games/tg-sdk-wrapper.js"></script>
<script>
(function(){
'use strict';
const I18N={
ko:{level:'Î†àÎ≤®',filled:'Ï±ÑÏõÄ',nextLevel:'Îã§Ïùå Î†àÎ≤®',complete:'ÏÉâÏπ† ÏôÑÎ£å!',perfect:'ÏôÑÎ≤Ω!',great:'ÌõåÎ•≠Ìï¥Ïöî!',good:'Ï¢ãÏïÑÏöî!'},
en:{level:'LEVEL',filled:'FILLED',nextLevel:'Next Level',complete:'Coloring Done!',perfect:'Perfect!',great:'Great!',good:'Good!'},
ja:{level:'„É¨„Éô„É´',filled:'Â°ó„Çä',nextLevel:'Ê¨°„ÅÆ„É¨„Éô„É´',complete:'Â°ó„ÇäÁµµÂÆå‰∫ÜÔºÅ',perfect:'ÂÆåÁíßÔºÅ',great:'Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ',good:'„Çà„Åè„Åß„Åç„ÅüÔºÅ'}
};
const ulang=(window.TG?.getLang?.()||navigator.language||'en').slice(0,2);
const lang=['ko','ja'].includes(ulang)?ulang:'en';
const t=k=>I18N[lang]?.[k]||I18N.en[k]||k;
document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.dataset.i18n;const v=t(k);if(v)el.textContent=v});

const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');

const COLORS=['#e94560','#4ea8ff','#50c878','#ffd700','#e070d0','#ff8c42','#00d2d3','#a29bfe','#fd79a8','#636e72','#2d3436','#dfe6e9'];
let W,H,level=1,currentColor=0,tool='brush',brushSize=12;
let grid=[],gridW=0,gridH=0,cellSize=0;
let regions=[],targetColors=[];
let painting=false,undoStack=[];
let totalCells=0,filledCells=0;

// Design patterns for each level
const PATTERNS=[
// Simple shapes
g=>{drawRect(g,0.2,0.2,0.6,0.6)},
g=>{drawCircle(g,0.5,0.5,0.3)},
g=>{drawRect(g,0.1,0.3,0.35,0.4);drawRect(g,0.55,0.3,0.35,0.4)},
g=>{drawCircle(g,0.3,0.3,0.15);drawCircle(g,0.7,0.3,0.15);drawCircle(g,0.5,0.65,0.2)},
g=>{drawTriangle(g,0.5,0.15,0.15,0.75,0.85,0.75)},
// More complex
g=>{drawStar(g,0.5,0.5,0.35)},
g=>{drawHeart(g,0.5,0.4,0.3)},
g=>{for(let i=0;i<3;i++)for(let j=0;j<3;j++)if((i+j)%2===0)drawRect(g,0.1+i*0.3,0.1+j*0.3,0.2,0.2)},
g=>{drawCircle(g,0.5,0.5,0.35);drawCircle(g,0.5,0.5,0.2)},
g=>{drawRect(g,0.15,0.15,0.7,0.7);drawRect(g,0.3,0.3,0.4,0.4)},
g=>{drawHouse(g)},
g=>{drawFlower(g)},
];

function resize(){
const wrap=document.querySelector('.canvas-wrap');
const r=wrap.getBoundingClientRect();
const s=Math.min(r.width-16,r.height-16,380);
W=H=s;
canvas.width=W;canvas.height=H;
canvas.style.width=W+'px';canvas.style.height=H+'px';
}

function initLevel(){
resize();
cellSize=4;
gridW=Math.floor(W/cellSize);
gridH=Math.floor(H/cellSize);
grid=Array.from({length:gridH},()=>Array(gridW).fill(0));
// 0=border(black), 1+=region IDs
// Draw pattern
const patIdx=(level-1)%PATTERNS.length;
PATTERNS[patIdx](grid);
// Identify regions and assign target colors
findRegions();
// Setup palette
const numColors=Math.min(2+Math.floor(level/2),8);
setupPalette(numColors);
undoStack=[];
updateProgress();
draw();
}

function drawRect(g,rx,ry,rw,rh){
const x1=Math.floor(rx*gridW),y1=Math.floor(ry*gridH);
const x2=Math.floor((rx+rw)*gridW),y2=Math.floor((ry+rh)*gridH);
for(let y=y1;y<y2;y++)for(let x=x1;x<x2;x++){
if(y>=0&&y<gridH&&x>=0&&x<gridW)g[y][x]=1;
}
// Border
for(let x=x1;x<x2;x++){if(y1>=0&&y1<gridH)g[y1][x]=0;if(y2-1>=0&&y2-1<gridH)g[y2-1][x]=0;}
for(let y=y1;y<y2;y++){if(x1>=0&&x1<gridW)g[y][x1]=0;if(x2-1>=0&&x2-1<gridW)g[y][x2-1]=0;}
}

function drawCircle(g,cx,cy,r){
const cxi=Math.floor(cx*gridW),cyi=Math.floor(cy*gridH),ri=Math.floor(r*Math.min(gridW,gridH));
for(let y=0;y<gridH;y++)for(let x=0;x<gridW;x++){
const d=Math.sqrt((x-cxi)**2+(y-cyi)**2);
if(d<ri-1)g[y][x]=1;
else if(d<ri+1)g[y][x]=0;
}
}

function drawTriangle(g,x1,y1,x2,y2,x3,y3){
const pts=[[x1*gridW,y1*gridH],[x2*gridW,y2*gridH],[x3*gridW,y3*gridH]];
for(let y=0;y<gridH;y++)for(let x=0;x<gridW;x++){
if(pointInTriangle(x,y,pts)&&!isEdge(x,y,pts))g[y][x]=1;
}
}
function pointInTriangle(px,py,pts){
const[a,b,c]=pts;
const d1=sign(px,py,a[0],a[1],b[0],b[1]);
const d2=sign(px,py,b[0],b[1],c[0],c[1]);
const d3=sign(px,py,c[0],c[1],a[0],a[1]);
const neg=(d1<0)||(d2<0)||(d3<0);
const pos=(d1>0)||(d2>0)||(d3>0);
return!(neg&&pos);
}
function sign(x1,y1,x2,y2,x3,y3){return(x1-x3)*(y2-y3)-(x2-x3)*(y1-y3)}
function isEdge(x,y,pts){return false;} // Simplified

function drawStar(g,cx,cy,r){
drawCircle(g,cx,cy,r);
const cxi=cx*gridW,cyi=cy*gridH,ri=r*Math.min(gridW,gridH);
for(let i=0;i<5;i++){
const a=Math.PI*2*i/5-Math.PI/2;
const tx=cxi+Math.cos(a)*ri;
const ty=cyi+Math.sin(a)*ri;
drawLine(g,cxi,cyi,tx,ty);
}
}
function drawHeart(g,cx,cy,r){
drawCircle(g,cx-r*0.5,cy-r*0.3,r*0.5);
drawCircle(g,cx+r*0.5,cy-r*0.3,r*0.5);
drawTriangle(g,cx-r,cy*0.95/gridH*gridH,cx,(cy+r*1.2)/gridH*gridH,cx+r,cy*0.95);
// Re-normalize coordinates
for(let y=0;y<gridH;y++)for(let x=0;x<gridW;x++){
if(g[y][x]===1){
const dx=x-cx*gridW,dy=y-cy*gridH;
if(dy>0&&Math.abs(dx)>r*gridW*(1-dy/(r*gridH*1.5)))g[y][x]=0;
}
}
}
function drawHouse(g){
drawRect(g,0.2,0.4,0.6,0.45);
drawTriangle(g,0.5,0.15,0.15,0.42,0.85,0.42);
drawRect(g,0.4,0.6,0.2,0.25);
}
function drawFlower(g){
for(let i=0;i<6;i++){
const a=Math.PI*2*i/6;
drawCircle(g,0.5+Math.cos(a)*0.15,0.5+Math.sin(a)*0.15,0.1);
}
drawCircle(g,0.5,0.5,0.08);
}
function drawLine(g,x1,y1,x2,y2){
const steps=Math.max(Math.abs(x2-x1),Math.abs(y2-y1));
for(let i=0;i<=steps;i++){
const x=Math.round(x1+(x2-x1)*i/steps);
const y=Math.round(y1+(y2-y1)*i/steps);
if(y>=0&&y<gridH&&x>=0&&x<gridW)g[y][x]=0;
}
}

function findRegions(){
regions=[];
const visited=Array.from({length:gridH},()=>Array(gridW).fill(false));
totalCells=0;filledCells=0;
for(let y=0;y<gridH;y++)for(let x=0;x<gridW;x++){
if(grid[y][x]===1&&!visited[y][x]){
const cells=[];
const queue=[[x,y]];
visited[y][x]=true;
while(queue.length){
const[cx,cy]=queue.shift();
cells.push([cx,cy]);
[[0,1],[0,-1],[1,0],[-1,0]].forEach(([dx,dy])=>{
const nx=cx+dx,ny=cy+dy;
if(nx>=0&&nx<gridW&&ny>=0&&ny<gridH&&!visited[ny][nx]&&grid[ny][nx]===1){
visited[ny][nx]=true;
queue.push([nx,ny]);
}
});
}
if(cells.length>10){
const rId=regions.length+2;
cells.forEach(([cx,cy])=>grid[cy][cx]=rId);
regions.push({id:rId,cells,color:null,targetColor:COLORS[regions.length%COLORS.length]});
totalCells+=cells.length;
}
}
}
}

function setupPalette(num){
const pal=document.getElementById('palette');
pal.innerHTML='';
for(let i=0;i<num;i++){
const btn=document.createElement('div');
btn.className='pal-btn'+(i===0?' active':'');
btn.style.background=COLORS[i];
btn.addEventListener('click',()=>{
currentColor=i;
pal.querySelectorAll('.pal-btn').forEach((b,j)=>b.classList.toggle('active',j===i));
window.TG?.haptic?.('selection');
});
pal.appendChild(btn);
}
}

function draw(){
ctx.fillStyle='#16213e';
ctx.fillRect(0,0,W,H);
for(let y=0;y<gridH;y++)for(let x=0;x<gridW;x++){
const v=grid[y][x];
if(v===0){
ctx.fillStyle='#2d3436';
ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
}else{
const region=regions.find(r=>r.id===v);
if(region&&region.color){
ctx.fillStyle=region.color;
ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
}else{
ctx.fillStyle='rgba(255,255,255,0.05)';
ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
}
}
}
}

function paintAt(px,py){
const x=Math.floor(px/cellSize);
const y=Math.floor(py/cellSize);
if(x<0||x>=gridW||y<0||y>=gridH)return;
const v=grid[y][x];
if(v<2)return;
const region=regions.find(r=>r.id===v);
if(!region)return;
const color=COLORS[currentColor];
if(tool==='fill'){
if(region.color!==color){
undoStack.push({regionId:region.id,oldColor:region.color});
region.color=color;
window.TG?.haptic?.('impact','medium');
}
}else{
// Brush: fill entire region on touch
if(region.color!==color){
undoStack.push({regionId:region.id,oldColor:region.color});
region.color=color;
window.TG?.haptic?.('impact','light');
}
}
updateProgress();
draw();
}

function updateProgress(){
filledCells=0;
regions.forEach(r=>{if(r.color)filledCells+=r.cells.length;});
const pct=totalCells>0?Math.round(filledCells/totalCells*100):0;
document.getElementById('pctVal').textContent=pct+'%';
document.getElementById('progressFill').style.width=pct+'%';
if(pct>=100)setTimeout(levelComplete,300);
}

function levelComplete(){
const stars=undoStack.length<=regions.length?3:undoStack.length<=regions.length*2?2:1;
document.getElementById('modalTitle').textContent=t('complete');
document.getElementById('modalScore').textContent='‚òÖ'.repeat(stars)+'‚òÜ'.repeat(3-stars);
document.getElementById('modalSub').textContent=t(stars===3?'perfect':stars===2?'great':'good');
document.getElementById('modalBg').style.display='flex';
window.TG?.haptic?.('notification','success');
if(window.GameScore)GameScore.save('color-fill',level*100);
}

// Input
function getPos(e){
const r=canvas.getBoundingClientRect();
const touch=e.touches?e.touches[0]:e;
return{x:touch.clientX-r.left,y:touch.clientY-r.top};
}
canvas.addEventListener('mousedown',e=>{painting=true;paintAt(getPos(e).x,getPos(e).y);});
canvas.addEventListener('touchstart',e=>{e.preventDefault();painting=true;paintAt(getPos(e).x,getPos(e).y);},{passive:false});
canvas.addEventListener('mousemove',e=>{if(painting&&tool==='brush')paintAt(getPos(e).x,getPos(e).y);});
canvas.addEventListener('touchmove',e=>{e.preventDefault();if(painting&&tool==='brush')paintAt(getPos(e).x,getPos(e).y);},{passive:false});
canvas.addEventListener('mouseup',()=>painting=false);
canvas.addEventListener('touchend',()=>painting=false);

document.getElementById('brushBtn').addEventListener('click',()=>{
tool='brush';
document.getElementById('brushBtn').classList.add('active');
document.getElementById('fillBtn').classList.remove('active');
});
document.getElementById('fillBtn').addEventListener('click',()=>{
tool='fill';
document.getElementById('fillBtn').classList.add('active');
document.getElementById('brushBtn').classList.remove('active');
});
document.getElementById('undoBtn').addEventListener('click',()=>{
if(undoStack.length){
const action=undoStack.pop();
const r=regions.find(r=>r.id===action.regionId);
if(r)r.color=action.oldColor;
updateProgress();draw();
}
});
document.getElementById('nextBtn').addEventListener('click',()=>{level++;document.getElementById('levelVal').textContent=level;initLevel();});
document.getElementById('modalNext').addEventListener('click',()=>{
level++;document.getElementById('levelVal').textContent=level;
document.getElementById('modalBg').style.display='none';
initLevel();
});

window.addEventListener('resize',()=>{initLevel();});
initLevel();
})();
</script>
<script src="/games/cross-promo.js"></script>
</body>
</html>

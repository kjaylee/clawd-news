# 033 - Puzzle Rogue Dungeon (퍼즐 로그 던전)

## 🎯 트렌드 근거
- **"Web Mid-Core" 부상** — 하이퍼캐주얼 쇠퇴, 깊이 있는 브라우저 게임이 대세 (PokeRogue 현상)
- **Puzzle RPG $9.7B 시장** — Puzzle & Dragons, Marvel Puzzle Quest 류가 캐주얼+코어 양쪽 흡인
- **로그라이크 루프** — "한 판만 더" 중독성, Slay the Spire식 선택지가 리텐션 극대화
- **브라우저 미드코어 체크리스트 충족**: 영속 저장, 전략적 깊이, 세션 유연성, 무설치

## 게임 컨셉
Match-3 전투 + 로그라이크 던전 탐험. 보석을 매치하여 몬스터와 전투하고, 프로시저럴 던전을 올라가며, 매 층마다 전략적 선택을 한다.

**한 줄 요약:** "Puzzle Quest × Slay the Spire — 브라우저에서 플레이하는 퍼즐 RPG 로그라이크"

## 핵심 메카닉

### 1. Match-3 전투 시스템
- **6×6 보석 그리드** (5색 + 2특수)
- 🔴 **화염석** → 공격력 (매치 수 × 공격배율)
- 🔵 **빙결석** → 방어/쉴드 (매치 수 × 방어배율)
- 🟢 **생명석** → HP 회복
- 🟡 **번개석** → 마나 충전 (스킬 사용)
- 🟣 **암흑석** → 궁극기 게이지
- ⭐ **스타석** (랜덤 등장) → 와일드카드 (아무 색 대체)
- 💀 **저주석** (보스전 등장) → 매치 불가, 장애물

### 2. 로그라이크 구조
- **25층 던전** (5층마다 보스)
- 매 층: 전투 → 보상 선택 → 다음 층
- **3갈래 경로 선택** (매 5층):
  - ⚔️ 정예 (어렵지만 희귀 보상)
  - 🛒 상점 (골드로 아이템 구매)
  - 🏕️ 휴식 (HP 30% 회복 또는 유물 강화)
- 사망 = 런 종료, 영구 보상 획득

### 3. 영웅 시스템 (4클래스)
| 영웅 | 특성 | 패시브 | 궁극기 |
|------|------|--------|--------|
| ⚔️ 전사 | HP↑ 공격↑ | 4+매치 시 추가 데미지 | 전체 공격 (200% 데미지) |
| 🧙 마법사 | 마나↑ 스킬↑ | 마나 매치 시 랜덤 보석 변환 | 보드 전체 리셋 + 데미지 |
| 🛡️ 기사 | HP↑↑ 방어↑ | 쉴드 매치 시 반사 데미지 | 3턴 무적 |
| 🗡️ 도적 | 공격↑↑ | 연쇄 매치 시 크리티컬 2× | 독 (3턴 DoT) |

### 4. 유물 시스템 (로그라이크 핵심)
- 런 중 획득하는 패시브 아이템 (최대 6개 슬롯)
- 유물 간 **시너지** 존재:
  - 🔥 화염의 반지 (화염석 데미지 +30%) + 🌋 용암 코어 (화염석 4+매치 시 폭발)
  - 🧊 얼음 왕관 (빙결석 매치 시 적 둔화) + ❄️ 동결의 눈 (둔화 3스택 = 빙결)
- **30+종** 유물, 런마다 다른 빌드 가능

### 5. 영속 메타 프로그레션
- **소울 포인트** (런 종료 시 획득, 도달 층수 기반)
- **영구 업그레이드**: 시작 HP, 시작 골드, 유물 슬롯, 새 영웅 해금
- **도감**: 몬스터, 유물, 보스 수집 (100% 채우기 도전)
- IndexedDB 저장 → 브라우저 닫아도 진행 유지

## 타겟 유저
- **1차**: Puzzle Quest, Slay the Spire, PokeRogue 팬
- **2차**: Match-3 게이머 중 깊이 원하는 유저
- **3차**: 로그라이크 팬 중 캐주얼 조작 원하는 유저
- **세션**: 5분 (퀵런) ~ 1시간 (풀런)

## 차별점
1. **브라우저 퍼즐 로그라이크 = 블루오션** — 모바일 앱은 많지만 HTML5 브라우저용은 극소수
2. **로그라이크 리플레이** — 매번 다른 유물/경로/빌드 → 무한 재플레이
3. **미드코어 깊이 + 캐주얼 접근성** — Match-3은 누구나 이해, 로그라이크는 코어 유저 유지
4. **무설치** — URL 클릭만으로 즉시 플레이
5. **오프라인 가능** — PWA + IndexedDB로 오프라인 플레이

## 수익 모델
- **프리미엄 지향** (미드코어 트렌드):
  - 기본 무료 (전사 클래스, 15층까지)
  - 풀 버전 해금: $2.99 (전 클래스 + 25층 + 보스)
  - 또는 리워드 광고로 1런 해금
- **코스메틱**: 보석 스킨 팩 $0.99
- **시즌**: 월간 특별 던전 (광고 시청으로 입장)

## 기술 스택
- HTML5 Canvas (전투 그리드)
- Vanilla JavaScript (의존성 없음)
- CSS3 (UI/트랜지션)
- IndexedDB (메타 프로그레션 저장)
- Service Worker (오프라인 지원)
- Web Audio API (효과음)

---

## 시스템 설계

### 게임 상태
```javascript
{
  // 런 상태
  run: {
    floor: number,         // 현재 층 (1-25)
    hero: HeroClass,       // 선택한 영웅
    hp: number,            // 현재 HP
    maxHp: number,
    mana: number,          // 현재 마나
    maxMana: number,
    gold: number,
    relics: Relic[],       // 보유 유물 (최대 6)
    ultimateGauge: number, // 0-100
    grid: GemType[][],     // 6×6 보석 그리드
  },
  // 전투 상태
  battle: {
    enemy: Enemy,          // 현재 적
    enemyHp: number,
    enemyMaxHp: number,
    enemyIntent: Intent,   // 다음 턴 행동 표시
    turnCount: number,
    debuffs: Debuff[],
    buffs: Buff[],
  },
  // 메타 (영속)
  meta: {
    soulPoints: number,    // 영구 재화
    unlockedHeroes: string[],
    upgrades: { startHp, startGold, relicSlots, ... },
    bestFloor: number,     // 최고 도달 층
    totalRuns: number,
    codex: { monsters: Set, relics: Set, bosses: Set },
  }
}
```

### 전투 흐름
```
[플레이어 턴]
  1. 보석 스와이프/매치
  2. 매치 결과 적용 (공격/방어/회복/마나)
  3. 연쇄 매치 확인
  4. 유물 효과 트리거
  5. 스킬 사용 (마나 소비)
     ↓
[적 턴]
  1. Intent 표시된 행동 실행
  2. 데미지/디버프 적용
  3. 쉴드로 방어
  4. 새 Intent 표시
     ↓
[턴 종료 체크]
  - 적 HP 0 → 승리 (보상)
  - 플레이어 HP 0 → 사망 (런 종료)
```

### 던전 생성 (프로시저럴)
```
Floor 1-4:   일반 몬스터 (HP 50-100, 약한 공격)
Floor 5:     ★ 미니보스 (HP 300, 특수 패턴)
Floor 6-9:   중급 몬스터 + 저주석 등장
Floor 10:    ★★ 중간보스 (HP 500, 2페이즈)
Floor 11-14: 고급 몬스터 + 환경 효과
Floor 15:    ★★★ 대보스 (HP 800, 3페이즈)
Floor 16-19: 엘리트 몬스터 (유물 드랍 확률 ↑)
Floor 20:    ★★★★ 상위보스 (HP 1200)
Floor 21-24: 최상급 + 복합 기믹
Floor 25:    ★★★★★ 최종보스 (HP 2000, 5페이즈)
```

### 몬스터 종류 (20+종)
| 몬스터 | 특성 | 등장 |
|--------|------|------|
| 슬라임 | 기본 공격 | F1-5 |
| 고블린 | 빠른 공격 (2턴마다) | F1-5 |
| 스켈레톤 | 방어 후 반격 | F3-8 |
| 독거미 | 독 디버프 | F5-10 |
| 골렘 | 높은 HP, 약한 공격 | F6-12 |
| 마법사 | 저주석 생성 | F8-15 |
| 뱀파이어 | 흡혈 공격 | F10-18 |
| 드래곤 | 전체 화염 (3턴 차지) | F15-25 |
| 리치 | 매 턴 저주석 2개 | F18-25 |
| 데몬 로드 | 랜덤 디버프 | F20-25 |

---

## UI/UX 플로우

### 메인 화면
```
┌──────────────────────────┐
│  ⚔️ PUZZLE ROGUE DUNGEON │
│  퍼즐 로그 던전           │
│                          │
│  ┌────────────────────┐  │
│  │ 🏰 NEW RUN         │  │
│  │ 📊 CODEX (45/120)  │  │
│  │ ⬆️ UPGRADES        │  │
│  │ 🏆 LEADERBOARD     │  │
│  └────────────────────┘  │
│                          │
│  💀 Best: Floor 18       │
│  🏃 Total Runs: 47       │
│  ✨ Soul Points: 2,340   │
└──────────────────────────┘
```

### 영웅 선택
```
┌──────────────────────────┐
│  SELECT HERO             │
│                          │
│  ⚔️ 전사    🧙 마법사   │
│  HP: 100    HP: 70       │
│  ATK: 12    ATK: 8       │
│  DEF: 8     MANA: 15     │
│                          │
│  🛡️ 기사    🗡️ 도적     │
│  HP: 120    HP: 80       │
│  ATK: 6     ATK: 15      │
│  DEF: 14    CRIT: 25%    │
│                          │
│  [🔒 Locked: 500 SP]     │
│  [ START ]               │
└──────────────────────────┘
```

### 전투 화면
```
┌──────────────────────────┐
│ F12/25  💀 뱀파이어      │
│ ███████░░░ HP: 340/500   │
│ Intent: ⚔️ 흡혈 (25dmg) │
├──────────────────────────┤
│ ┌──┬──┬──┬──┬──┬──┐     │
│ │🔴│🔵│🟢│🔴│🟡│🟣│     │
│ ├──┼──┼──┼──┼──┼──┤     │
│ │🟡│🔴│🔵│🟢│🔴│🔵│     │
│ ├──┼──┼──┼──┼──┼──┤     │
│ │🟢│🟡│🔴│🟣│🔵│🟢│     │
│ ├──┼──┼──┼──┼──┼──┤     │
│ │🔵│🟢│🟡│🔴│🟢│🟡│     │
│ ├──┼──┼──┼──┼──┼──┤     │
│ │🔴│🟣│🟢│🔵│🟡│🔴│     │
│ ├──┼──┼──┼──┼──┼──┤     │
│ │🟣│🔵│🔴│🟢│🔴│🟣│     │
│ └──┴──┴──┴──┴──┴──┘     │
├──────────────────────────┤
│ ❤️ 78/100  🛡️ 12        │
│ ✨ 8/15 Mana  💀 67% Ult │
│ [⚡SKILL] [💀ULT]       │
├──────────────────────────┤
│ 🏺 유물: 🔥🧊⭐🎯       │
│ 💰 Gold: 245             │
└──────────────────────────┘
```

### 보상 선택 (층 클리어 후)
```
┌──────────────────────────┐
│  ✨ FLOOR 12 CLEAR!      │
│  Choose your reward:     │
│                          │
│  ┌────┐ ┌────┐ ┌────┐   │
│  │ 🔥 │ │ 💎 │ │ ❤️ │   │
│  │화염 │ │다이│ │생명│   │
│  │반지 │ │아몬│ │물약│   │
│  │ATK  │ │드  │ │+30 │   │
│  │+30% │ │+1  │ │HP  │   │
│  │ RED │ │SLOT│ │HEAL│   │
│  └────┘ └────┘ └────┘   │
│                          │
│  Next: ⚔️정예 🛒상점 🏕️│
└──────────────────────────┘
```

---

## 밸런스 파라미터

### 영웅 기본 스탯
| 영웅 | HP | ATK | DEF | MANA | CRIT |
|------|-----|-----|-----|------|------|
| 전사 | 100 | 12 | 8 | 8 | 10% |
| 마법사 | 70 | 8 | 5 | 15 | 5% |
| 기사 | 120 | 6 | 14 | 6 | 5% |
| 도적 | 80 | 15 | 5 | 10 | 25% |

### 매치 데미지 계산
```
기본: 매치 수 × ATK × 색상배율
4매치: ×1.5 + 특수효과
5매치: ×2.0 + 라인 폭발
연쇄: 연쇄 수 × 0.5 추가배율
크리티컬: ×2.0 (CRIT% 확률)
```

### 적 스케일링
```
HP: 50 + (floor × 20) + random(0, floor × 5)
ATK: 5 + (floor × 2)
보스: HP ×3, ATK ×1.5, 특수 패턴
```

### 메타 프로그레션 비용
| 업그레이드 | 효과 | 비용 (SP) |
|------------|------|-----------|
| 시작 HP +10 | 최대 5레벨 | 100, 200, 400, 800, 1600 |
| 시작 골드 +50 | 최대 3레벨 | 200, 500, 1000 |
| 유물 슬롯 +1 | 최대 2레벨 | 500, 1500 |
| 마법사 해금 | 1회 | 500 |
| 기사 해금 | 1회 | 800 |
| 도적 해금 | 1회 | 1200 |

### 경제 밸런스
- 런 평균 소울포인트: 도달층 × 10 + 처치몬스터 × 2
- F5 도달: ~70 SP (약 7런으로 첫 업그레이드)
- F15 도달: ~200 SP
- F25 클리어: ~400 SP

---

## 구현 우선순위
1. ⬜ 6×6 매치-3 그리드 (스와이프, 매치, 연쇄, 새 보석 드랍)
2. ⬜ 전투 시스템 (적 표시, HP바, 데미지 계산, 턴제)
3. ⬜ 던전 진행 (층 이동, 몬스터 스케일링)
4. ⬜ 영웅 선택 (4클래스, 고유 패시브/궁극기)
5. ⬜ 유물 시스템 (보상 선택, 패시브 효과)
6. ⬜ 보스전 (5층 간격, 특수 패턴)
7. ⬜ 메타 프로그레션 (IndexedDB, 영구 업그레이드, 도감)
8. ⬜ UI 폴리싱 (애니메이션, 이펙트, 사운드)
9. ⬜ PWA + 오프라인 지원

## 예상 구현 규모
- **코드**: ~3000-5000줄 (단일 HTML5)
- **난이도**: ★★★★☆ (미드코어급 시스템 복잡도)
- **예상 시간**: 서브에이전트 3-5시간

---

## 구현 상태
- [x] 기획서 작성 (2026-01-30)
- [ ] 프로토타입 구현

---
*생성일: 2026-01-30 22:00*
*트렌드 근거: Web Mid-Core 부상 (dev.to 2026), Puzzle RPG $9.7B 시장, PokeRogue 현상*
*전략: 피라미드 🔶 중간층 — 하이퍼캐주얼 양산에서 미드코어 진입 첫 발*

# 035. Card Dungeon Crawler - 카드 던전 크롤러

## 게임 컨셉
**한 줄 요약:** 브라우저에서 즐기는 Slay the Spire 스타일 덱빌딩 로그라이트

2026년 최대 트렌드 "Web Mid-Core" 시대에 맞춘 덱빌딩 로그라이트. 카드로 전투하며 절차적 던전을 탐험. 한 런에 15-20분, 런 간 영구 언락. 브라우저에서 설치 없이 즉시 플레이. PokeRogue 현상 + Slay the Spire 메카닉 = 브라우저 Mid-Core 킬러.

## 핵심 메카닉
1. **덱빌딩**: 10장 기본덱 시작 → 전투 후 카드 획득/제거로 덱 커스텀
2. **턴제 전투**: 매 턴 에너지 3 → 카드 사용 (공격/방어/스킬), 적 의도 표시
3. **절차적 던전**: 3개 Act, 각 15+ 노드. 분기점에서 경로 선택 (전투/이벤트/상점/휴식)
4. **유물 시스템**: 패시브 효과 유물 수집 → 시너지 극대화
5. **영구 언락**: 런 성과에 따라 새 카드/유물/캐릭터 해금

## 카드 시스템

### 기본 카드풀 (스타터)
| 카드 | 비용 | 효과 |
|------|------|------|
| ⚔️ 베기 | 1 | 6 데미지 |
| 🛡️ 방어 | 1 | 5 블록 |
| 🔥 화염구 | 2 | 12 데미지 |
| ⚡ 전기충격 | 1 | 4 데미지 + 1 카드 드로우 |

### 레어 카드 예시
| 카드 | 비용 | 효과 |
|------|------|------|
| 💀 죽음의 손길 | 2 | 15 데미지, 체력 5 회복 |
| 🌊 연쇄 번개 | 3 | 적 전체에 8 데미지 |
| 🏰 철벽 | 2 | 15 블록, 다음 턴 에너지 -1 |
| 🃏 복제 | 1 | 손에 든 랜덤 카드 1장 복사 |

### 카드 키워드
- **독**: 턴 종료 시 N 데미지 (누적)
- **블록**: 다음 적 공격까지 데미지 감소
- **드로우**: 카드 추가 뽑기
- **소멸**: 사용 후 덱에서 영구 제거
- **유지**: 턴 넘겨도 손에 남음

## 유물 시스템

### 일반 유물
| 유물 | 효과 |
|------|------|
| 🔮 수정구슬 | 전투 시작 시 카드 1장 추가 드로우 |
| 💎 루비 반지 | 매 3전투마다 체력 10 회복 |
| ⚙️ 톱니바퀴 | 에너지 사용 안 한 턴: 블록 4 자동 획득 |

### 레어 유물
| 유물 | 효과 |
|------|------|
| 👑 왕관 | 에너지 +1, 최대 체력 -10 |
| 📖 마법서 | 매 전투 시작 시 랜덤 카드 1장 생성 |
| 🗡️ 저주받은 검 | 공격 데미지 +50%, 블록 효과 -25% |

## 던전 구조

### Act 1: 유적 (노드 15개)
- 일반 몬스터: 슬라임, 해골, 고블린
- 엘리트: 미노타우르스 (높은 체력, 강타 패턴)
- 보스: 고대 골렘 (블록 + 강타 패턴)

### Act 2: 화산 (노드 18개)
- 일반 몬스터: 화염 정령, 마법사, 암살자
- 엘리트: 드래곤 새끼 (화상 도트 데미지)
- 보스: 용암왕 (부하 소환 + 전체 공격)

### Act 3: 심연 (노드 20개)
- 일반 몬스터: 그림자, 악마, 리치
- 엘리트: 타락 기사 (카드 무효화)
- 보스: 심연의 군주 (적응형 AI — 플레이어 전략 카운터)

### 노드 유형
```
⚔️ 전투: 적과 전투 → 카드 보상
❓ 이벤트: 랜덤 이벤트 (보상/위험/선택)
🏪 상점: 카드/유물 구매, 카드 제거 (골드)
🔥 휴식: 체력 회복 OR 카드 강화
💀 엘리트: 강적 → 유물 보상
👿 보스: Act 보스 → 다음 Act
💰 보물: 유물 획득 (확률)
```

### 맵 시각화
```
       [👿]
      /    \
   [⚔️]  [❓]
   / \     |
[🏪] [⚔️] [🔥]
  |   |   / \
[⚔️] [💀] [⚔️] [❓]
   \  |  / \  /
    [⚔️] [🏪]
      \  /
      [START]
```

## 타겟 유저
- 20-40대 남녀 게이머
- 로그라이크/덱빌딩 팬 (Slay the Spire, Balatro 유저)
- 브라우저 게임 유저 (설치 싫어하는 PC/모바일 겸용)
- "한 판만 더" 중독형 플레이어

## 차별점
1. **브라우저 네이티브**: 설치 불필요, URL 공유만으로 전파
2. **IndexedDB 자동저장**: 탭 닫아도 진행 유지, 기기 간 동기화 가능
3. **15분 런**: 출퇴근/쉬는시간에 한 런 가능
4. **적 의도 표시**: 초보자도 전략적 플레이 가능
5. **위클리 챌린지**: 매주 특수 규칙 + 글로벌 랭킹

## 수익 모델
- **보상형 광고 (고가치)**:
  - 유물 재굴림 (전투 후)
  - 부활 1회 (런 중 1번)
  - 골드 2배 보상
- **코스메틱 IAP**:
  - 카드 뒷면 스킨: $0.99
  - 테마 팩 (던전 비주얼): $1.99
  - 캐릭터 스킨: $2.99
- **시즌 패스**: $4.99/시즌 (4주)
  - 독점 카드 아트
  - 추가 챌린지
  - 코스메틱 보상

## 기술 스택
- **엔진**: HTML5 Canvas + Vanilla JavaScript
- **렌더링**: 카드/UI는 DOM, 이펙트는 Canvas 오버레이
- **저장**: IndexedDB (런 진행 + 영구 언락 + 통계)
- **RNG**: 시드 기반 PRNG (결정론적 → 리플레이/공유 가능)
- **애니메이션**: requestAnimationFrame + CSS transitions
- **배포**: GitHub Pages → 텔레그램 Mini App

---

## 시스템 설계

### 게임 상태 구조
```javascript
const gameState = {
  // 런 상태
  run: {
    act: 1,
    currentNode: 0,
    map: [],              // 절차적 생성 맵
    deck: [],             // 현재 덱
    relics: [],           // 보유 유물
    hp: 80,
    maxHp: 80,
    gold: 99,
    potions: [],          // 소비 아이템 (최대 3)
  },
  
  // 전투 상태
  combat: {
    hand: [],             // 손패
    drawPile: [],         // 뽑을 더미
    discardPile: [],      // 버린 더미
    exhaustPile: [],      // 소멸 더미
    energy: 3,
    maxEnergy: 3,
    enemies: [],
    turn: 0,
    block: 0,
  },
  
  // 영구 데이터
  meta: {
    totalRuns: 0,
    wins: 0,
    unlockedCards: [],
    unlockedRelics: [],
    unlockedCharacters: ['warrior'],
    achievements: [],
    stats: {},
  }
};
```

### 전투 루프
```
턴 시작
  → 에너지 리셋 (3)
  → 카드 5장 드로우
  → 유물/버프 트리거
  
플레이어 턴
  → 카드 선택 + 대상 지정
  → 카드 효과 적용
  → 에너지 차감
  → (반복)
  → '턴 종료' 버튼
  
턴 종료
  → 남은 손패 버리기
  → 블록 리셋
  → 적 의도 실행
  → 독/버프/디버프 처리
  → 승리/패배 체크
```

### 적 AI
```javascript
class Enemy {
  constructor(data) {
    this.name = data.name;
    this.hp = data.hp;
    this.maxHp = data.hp;
    this.block = 0;
    this.intentPattern = data.pattern; // ['attack:12', 'defend:8', 'buff:str+3']
    this.turnIndex = 0;
  }
  
  getIntent() {
    return this.intentPattern[this.turnIndex % this.intentPattern.length];
  }
  
  executeIntent(player) {
    const intent = this.getIntent();
    const [action, value] = intent.split(':');
    switch(action) {
      case 'attack': 
        player.takeDamage(parseInt(value)); 
        break;
      case 'defend': 
        this.block += parseInt(value); 
        break;
      case 'buff':
        this.applyBuff(value);
        break;
      case 'summon':
        this.summonMinion(value);
        break;
    }
    this.turnIndex++;
  }
}
```

### 맵 생성 알고리즘
```javascript
function generateMap(act) {
  const nodeCount = 15 + (act - 1) * 3;
  const layers = [];
  
  // 레이어별 노드 생성
  for (let i = 0; i < nodeCount; i++) {
    const layer = Math.floor(i * 5 / nodeCount); // 5개 레이어
    const nodeType = pickNodeType(i, nodeCount, act);
    layers.push({ type: nodeType, connections: [] });
  }
  
  // 연결 생성 (분기 + 합류)
  // 보스 노드는 항상 마지막
  // 엘리트는 중간에 2-3개
  // 상점/휴식은 보스 전에 보장
  
  return layers;
}
```

---

## UI/UX 플로우

### 메인 화면
```
┌─────────────────────┐
│  ⚔️ CARD DUNGEON    │
│                     │
│  [▶ 새 탐험]       │
│  [📊 기록]         │
│  [🏆 주간 챌린지]   │
│  [📖 카드 도감]     │
│                     │
│  🏅 승리: 12/47    │
│  🃏 카드: 68/120   │
└─────────────────────┘
```

### 맵 화면
```
┌─────────────────────┐
│ Act 1: 유적  HP: 80 │
│ 💰 99  🧪 1/3       │
├─────────────────────┤
│       [👿]          │
│      /    \         │
│   [⚔️]  [❓]       │
│   / \     |         │
│ [🏪] [⚔️] [🔥]    │
│   |   |   / \      │
│ [⚔️] [💀] [⚔️] [❓]│
│   \  |  / \  /     │
│   [⚔️] [🏪]        │
│     \  /            │
│     [👤] ← 현재    │
├─────────────────────┤
│ 덱: 12장  유물: 3   │
└─────────────────────┘
```

### 전투 화면
```
┌─────────────────────┐
│ 🗡️ 고블린 전사      │
│ ❤️ 28/35  🛡️ 0     │
│ 의도: ⚔️ 12 데미지  │
├─────────────────────┤
│                     │
│  [적 캐릭터 영역]    │
│                     │
├─────────────────────┤
│ ❤️ 65/80 🛡️ 5      │
│ ⚡ 2/3 에너지       │
├─────────────────────┤
│ ┌───┐┌───┐┌───┐┌───┐│
│ │⚔️ ││🛡️ ││🔥 ││⚡ ││
│ │베기││방어││화염││충격││
│ │ 1 ││ 1 ││ 2 ││ 1 ││
│ └───┘└───┘└───┘└───┘│
│    [🔚 턴 종료]      │
└─────────────────────┘
```

### 카드 보상 화면
```
┌─────────────────────┐
│   💰 +25 골드       │
│   카드 1장 선택:    │
│                     │
│ ┌─────┐┌─────┐┌─────┐│
│ │🗡️   ││🛡️   ││🔮   ││
│ │이중  ││거울  ││흡혈  ││
│ │베기  ││방어  ││의식  ││
│ │      ││      ││      ││
│ │2: 14 ││1: 10 ││2: 독8││
│ │데미지││블록  ││+회복 ││
│ └─────┘└─────┘└─────┘│
│     [건너뛰기]       │
└─────────────────────┘
```

---

## 밸런스 파라미터

### 플레이어
```javascript
const PLAYER_BALANCE = {
  startHp: 80,
  maxHp: 80,
  startEnergy: 3,
  handSize: 5,
  startDeckSize: 10,  // 베기x5 + 방어x4 + 화염구x1
  startGold: 99,
  maxPotions: 3,
};
```

### 적 밸런스 (Act 1)
| 적 | 체력 | 공격 | 패턴 |
|-----|------|------|------|
| 슬라임 | 12 | 5 | 공격→공격→방어 |
| 해골 | 20 | 8 | 공격→방어→강화→공격 |
| 고블린 | 15 | 6 | 공격→도주(체력<5시) |
| 🌟 미노타우르스 | 50 | 15 | 강타→방어→방어→강타 |
| 👿 고대 골렘 | 100 | 20 | 방어→강타→소환→전체공격 |

### 경제
| 행동 | 골드 |
|------|------|
| 일반 전투 승리 | 15-25 |
| 엘리트 승리 | 30-50 |
| 카드 제거 (상점) | 50 |
| 카드 구매 | 50-150 |
| 유물 구매 | 150-300 |
| 포션 구매 | 50-75 |

### 카드 보상
- 일반 전투: 3장 중 1선택 (일반 80%, 언커먼 15%, 레어 5%)
- 엘리트 전투: 3장 중 1선택 (일반 40%, 언커먼 40%, 레어 20%)
- 보스 전투: 유물 1개 (3개 중 선택) + 카드 보상

### 난이도 스케일링
| Act | 적 HP 배율 | 적 DMG 배율 | 골드 배율 |
|-----|-----------|-----------|----------|
| 1 | 1.0x | 1.0x | 1.0x |
| 2 | 1.8x | 1.5x | 1.3x |
| 3 | 2.5x | 2.0x | 1.5x |

---

## 영구 진행

### 언락 조건
| 언락 | 조건 |
|------|------|
| 마법사 캐릭터 | 첫 클리어 |
| 도적 캐릭터 | 50턴 이내 클리어 |
| 레어 카드풀 | 5승 |
| 고급 유물풀 | 10승 |
| 주간 챌린지 | 3승 |
| 카드 도감 | 누적 플레이 |

### 통계 추적
- 총 런 수, 승률, 최대 층 도달
- 가장 많이 사용한 카드 TOP 10
- 가장 높은 단일 턴 데미지
- 평균 런 시간, 평균 턴 수

---

## 구현 우선순위

### MVP (핵심)
1. 카드 렌더링 + 드래그 앤 드롭 (또는 탭)
2. 턴제 전투 루프 (에너지, 공격, 방어)
3. 적 AI (의도 표시 + 실행)
4. 기본 덱 (10장) + 보상 카드 (20장)
5. Act 1 맵 (15노드, 전투/휴식/상점)
6. HP/블록/에너지 시스템
7. 기본 UI (전투, 맵, 카드 보상)

### 폴리시
8. 애니메이션 (카드 플레이, 데미지, 전환)
9. 유물 시스템 (10개)
10. 이벤트 노드 (5개 이벤트)
11. Act 2-3 (적 + 보스)
12. IndexedDB 저장 (런 + 영구 언락)

### 확장
13. 추가 캐릭터 (마법사, 도적)
14. 카드풀 확장 (100+)
15. 주간 챌린지 + 랭킹
16. 텔레그램 Mini App 통합
17. 사운드/음악

---

## 구현 체크리스트
- [x] 기획서 작성
- [ ] MVP 구현
- [ ] 전투 시스템
- [ ] 맵 시스템
- [ ] 영구 저장
- [ ] 폴리시
- [ ] 출시

---
*생성일: 2026-01-31*
*기반 트렌드: Web Mid-Core 시대 도래, PokeRogue 현상, Slay the Spire 브라우저 적응*
*목표: 브라우저 최초의 본격 덱빌딩 로그라이트 — 설치 없이 Slay the Spire 경험*

# 029 — Gem Cascade 💎

> Cluster Clearing + Cascade Chain = 중독성 극대화 퍼즐

## 🎯 게임 컨셉
보드에 쌓인 다양한 색상 보석을 탭해서 같은 색 클러스터를 제거. 위에 있던 보석이 떨어지며
새로운 매칭을 만들어내는 **연쇄 폭발(Cascade)**이 핵심 쾌감. 간단한 탭 조작이지만
어디를 먼저 터치할지가 점수를 좌우하는 전략 퍼즐.

## 🕹️ 핵심 메카닉
1. **클러스터 탭:** 2개 이상 인접한 같은 색 보석 탭 → 한꺼번에 제거
2. **중력 낙하:** 제거된 빈 공간으로 위 보석이 떨어짐
3. **캐스케이드 체인:** 낙하 후 새 클러스터 형성 → 자동 제거 → 연쇄 반응
4. **보석 크기 보너스:** 큰 클러스터일수록 기하급수적 점수 (n² 공식)
5. **스페셜 보석:** 7+ 클러스터 제거 시 특수 보석 생성 (폭탄, 레인보우, 라인)
6. **웨이브 시스템:** 일정 점수 달성 → 새 줄 추가, 속도/복잡도 증가

## 👥 타겟 유저
- Match-3 팬 (캔디크러시, 로얄매치 유저)
- 짧은 세션 (1-3분) 캐주얼 게이머
- 연쇄 반응/도미노 효과에 만족감 느끼는 유저 (25-44세)

## 💎 차별점
1. **캐스케이드 쾌감:** 한 번의 탭으로 연쇄 폭발이 화면을 뒤흔드는 카타르시스
2. **전략적 깊이:** 단순 탭이지만 순서가 결과를 바꿈 (체스적 사고)
3. **스페셜 보석 콤보:** 특수 보석끼리 만나면 메가 폭발 (폭탄+레인보우 = 전체 색 제거)
4. **무한 모드 + 레벨 모드:** 엔들리스 서바이벌 + 목표 달성형 레벨

## 💰 수익 모델
- **리워드 광고:**
  - 추가 5무브 (레벨 모드)
  - 셔플 부스터
  - 점수 2배
- **IAP:**
  - 광고 제거: $2.99
  - 부스터 팩: $0.99 ~ $4.99
  - 테마 팩 (보석 스킨): $1.99

## 🛠️ 기술 스택
- **HTML5 Canvas + Vanilla JavaScript**
- 외부 라이브러리 없음
- 모바일 터치 + 데스크탑 클릭

---

## 📐 시스템 설계

### 게임 오브젝트
```javascript
Board {
  cols: 8,              // 열 수
  rows: 10,             // 행 수
  grid: Gem[][],        // 2D 배열
  score: number,
  cascadeCount: number, // 현재 연쇄 수
}

Gem {
  col, row: number,     // 그리드 위치
  x, y: number,         // 렌더링 위치 (애니메이션용)
  color: string,        // 'ruby'|'sapphire'|'emerald'|'topaz'|'amethyst'|'diamond'
  type: 'normal'|'bomb'|'rainbow'|'line',
  scale: number,        // 애니메이션용
  falling: boolean,
}

Particle {
  x, y: number,
  vx, vy: number,
  color: string,
  life: number,
  size: number,
}
```

### 게임 루프 (무한 모드)
1. **유저 탭:** 보석 위치 감지 → 클러스터 탐색 (BFS)
2. **클러스터 검증:** 2개 이상이면 제거 가능
3. **제거 애니메이션:** 폭발 파티클 + 점수 팝업
4. **스페셜 생성:** 7+ 클러스터 → 특수 보석 드롭
5. **중력 낙하:** 빈 공간으로 위 보석 이동 (트윈 애니메이션)
6. **새 보석 충전:** 상단에서 새 보석 떨어짐
7. **캐스케이드 체크:** 새 클러스터 있으면 자동 제거 (→ 3번으로)
8. **웨이브 체크:** 목표 점수 달성 시 새 줄 추가 + 난이도 상승
9. **게임 오버:** 보석이 최상단 넘어서면 종료

### 레벨 모드 (추가)
- 제한된 무브(탭) 수 내에 목표 점수 달성
- 특정 색 보석 N개 제거
- 특수 보석 사용 미션

### 점수 계산
```javascript
// 클러스터 점수: n² × 10 × cascadeMultiplier
function calcScore(clusterSize, cascadeLevel) {
  const base = clusterSize * clusterSize * 10;
  const cascadeBonus = 1 + (cascadeLevel * 0.5);
  return Math.floor(base * cascadeBonus);
}
// 예시: 5개 클러스터 × 3연쇄 = 25 × 10 × 2.5 = 625점
```

### 스페셜 보석
| 조건 | 생성 | 효과 |
|------|------|------|
| 7+ 클러스터 제거 | 💣 폭탄 | 3×3 영역 제거 |
| 10+ 클러스터 제거 | 🌈 레인보우 | 탭한 색 전체 제거 |
| 13+ 클러스터 제거 | ⚡ 라인 | 가로+세로 한 줄 제거 |
| 💣+💣 | 메가 폭탄 | 5×5 영역 제거 |
| 💣+🌈 | 컬러 폭탄 | 해당 색 전부 폭탄으로 변환 후 폭발 |
| 🌈+🌈 | 전체 클리어 | 보드 전체 제거 |

## 🎨 UI/UX 플로우

### 메인 화면
```
┌─────────────────────────┐
│     💎 GEM CASCADE      │
│                         │
│     [▶ 무한 모드]       │
│     [📋 레벨 모드]      │
│     [🏆 1,234,567]      │
│                         │
│     [🎨 테마] [⚙️ 설정] │
└─────────────────────────┘
```

### 게임 화면
```
┌─────────────────────────┐
│ Score: 45,230  Chain: 5 │
│ Wave: 7   Best: 98,400  │
├─────────────────────────┤
│ 🔴🔵🟢🟡🔴🟣🔵🟢 │
│ 🟡🔴🔴🔵🟢🟡🔴🟣 │
│ 🔵🟢🔴🔴🔴🔵🟢🟡 │
│ 🟣🔵🟢🟡🔵🔴🟣🔴 │
│ 🔴🟡🔵🟢🟡🟢🔵🟢 │
│ 🟢🔴🟣🔵🔴🟡🔴🟣 │
│ 🔵🟢🔴🟡🟢🔵🟡🔴 │
│ 🟡🔵🟢🔴🟣🔴🟢🔵 │
│ 🔴🟣🟡🔵🔴🟢🟣🟡 │
│ 🟢🔴🔵🟢🟡🟣🔴🔵 │
├─────────────────────────┤
│     CASCADE! x5 🔥      │
└─────────────────────────┘
```

### 연쇄 반응 연출
```
탭! → [제거 → 파티클] → [낙하 ↓] → [새 매칭!] → [제거 → 파티클] → ...
      0.3s              0.4s        0.1s          0.3s
총 캐스케이드 소요: 0.8s × 연쇄수
```

### 결과 화면
```
┌─────────────────────────┐
│    💎 GAME OVER 💎      │
│                         │
│   Score: 156,780        │
│   Best Chain: x12       │
│   Wave: 14              │
│   Best: 234,500         │
│                         │
│   [🎬 점수 2x]         │
│   [▶ 다시하기]         │
│   [🏠 홈]              │
└─────────────────────────┘
```

## ⚖️ 밸런스 파라미터
```javascript
const BALANCE = {
  // 보드
  COLS: 8,
  ROWS: 10,
  NUM_COLORS: 5,          // 기본 색상 수 (웨이브별 증가)
  MIN_CLUSTER: 2,         // 최소 클러스터 크기
  
  // 스페셜
  BOMB_THRESHOLD: 7,      // 폭탄 생성 조건
  RAINBOW_THRESHOLD: 10,  // 레인보우 생성 조건
  LINE_THRESHOLD: 13,     // 라인 생성 조건
  
  // 애니메이션
  FALL_SPEED: 12,         // px/frame
  POP_DURATION: 300,      // ms
  CASCADE_DELAY: 200,     // ms (연쇄 간 딜레이)
  
  // 웨이브
  WAVE_SCORE_TARGET: 5000, // 웨이브당 목표 점수
  WAVE_NEW_ROWS: 1,        // 웨이브마다 추가 줄
  MAX_COLORS: 6,           // 최대 색상 수 (웨이브 15+)
  
  // 점수
  SCORE_BASE: 10,          // n² × base × cascadeBonus
  CASCADE_BONUS: 0.5,      // 연쇄당 배수 증가
  
  // 게임 오버
  TOP_ROW_THRESHOLD: 0,    // 0번 행 초과 시 게임 오버
};
```

## 📈 리텐션 요소
- **일일 챌린지:** 매일 같은 보드 → 글로벌 랭킹
- **레벨 모드:** 점진적 난이도 100+ 레벨
- **업적:** "10연쇄 달성", "10만점 돌파", "레인보우×레인보우 사용" 등
- **테마:** 루비(기본), 바다, 숲, 우주 스킨
- **하이스코어:** LocalStorage 영구 저장

## 📊 상업적 전망
- **Match-3 시장:** $9.7B (캐주얼 40% 매출)
- **D30 리텐션 예상:** 14-20% (하이브리드 캐주얼 기준)
- **탭 조작:** 접근성 최고 (한 손 플레이)
- **캐스케이드:** 입소문 바이럴 가능 (멋진 연쇄 영상 공유)

---
*Created: 2026-01-30 | Status: 미구현 | Trend: Match-3 $9.7B 시장 + 캐스케이드 메카닉*

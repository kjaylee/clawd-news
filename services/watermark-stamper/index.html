<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watermark Stamper â€” ì´ë¯¸ì§€ ì›Œí„°ë§ˆí¬ ë„êµ¬ | East Sea Tools</title>
<meta name="description" content="ëŒ€ëŸ‰ ì´ë¯¸ì§€ì— ì›Œí„°ë§ˆí¬ë¥¼ ì¼ê´„ ì‚½ì…í•˜ì„¸ìš”. í…ìŠ¤íŠ¸/ì´ë¯¸ì§€ ì›Œí„°ë§ˆí¬, ìœ„ì¹˜Â·íˆ¬ëª…ë„Â·í¬ê¸° ì¡°ì ˆ. 100% ë¸Œë¼ìš°ì € ì²˜ë¦¬, ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ.">
<meta name="keywords" content="watermark, ì›Œí„°ë§ˆí¬, image watermark, batch watermark, ì´ë¯¸ì§€ ì›Œí„°ë§ˆí¬, ëŒ€ëŸ‰ ì›Œí„°ë§ˆí¬">
<link rel="canonical" href="https://eastsea.monster/services/watermark-stamper/">
<meta property="og:title" content="ğŸ’§ Watermark Stamper â€” ì´ë¯¸ì§€ ì›Œí„°ë§ˆí¬ ë„êµ¬">
<meta property="og:description" content="ëŒ€ëŸ‰ ì´ë¯¸ì§€ì— ì›Œí„°ë§ˆí¬ë¥¼ ì¼ê´„ ì‚½ì…í•˜ì„¸ìš”. ì„œë²„ ì—…ë¡œë“œ ì—†ì´ 100% ë¸Œë¼ìš°ì € ì²˜ë¦¬.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://eastsea.monster/services/watermark-stamper/">
<meta property="og:site_name" content="East Sea Tools">
<meta name="twitter:card" content="summary">
<style>
:root{--bg:#0a0a12;--card:#12121f;--border:#1f1f2e;--accent:#667eea;--accent2:#764ba2;--pink:#ff6b9d;--text:#e0e0e0;--muted:#888;--dim:#555;--radius:14px;--green:#4ade80;--red:#ef4444;--yellow:#fbbf24}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6}
.top-bar{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);z-index:10}
.top-bar a{color:var(--muted);text-decoration:none;font-size:.85rem}.top-bar a:hover{color:var(--accent)}
.lang-btn{background:var(--card);border:1px solid var(--border);color:var(--muted);padding:4px 12px;border-radius:8px;cursor:pointer;font-size:.8rem}
.container{max-width:700px;margin:0 auto;padding:30px 20px 60px}
h1{font-size:clamp(1.5rem,4vw,2rem);font-weight:800;text-align:center;margin-bottom:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{text-align:center;color:var(--muted);margin-bottom:30px;font-size:.9rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px}
.card h2{font-size:.95rem;margin-bottom:14px;color:var(--accent)}
.drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:40px 20px;text-align:center;cursor:pointer;transition:border-color .2s,background .2s}
.drop-zone:hover,.drop-zone.over{border-color:var(--accent);background:rgba(102,126,234,.05)}
.drop-zone p{color:var(--muted);font-size:.9rem;margin-top:8px}
.drop-zone .icon{font-size:2rem;margin-bottom:8px}
.file-count{text-align:center;margin-top:10px;font-size:.85rem;color:var(--green)}
.tabs{display:flex;gap:8px;margin-bottom:16px}
.tab{flex:1;padding:10px;text-align:center;background:var(--bg);border:1px solid var(--border);border-radius:10px;cursor:pointer;font-size:.85rem;transition:all .2s}
.tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:6px}
.form-group input[type=text],.form-group input[type=number],.form-group select{width:100%;padding:10px 14px;background:var(--bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:.9rem}
.form-group input:focus,.form-group select:focus{outline:none;border-color:var(--accent)}
.row{display:flex;gap:12px}
.row .form-group{flex:1}
input[type=range]{width:100%;accent-color:var(--accent)}
.range-val{display:flex;justify-content:space-between;font-size:.8rem;color:var(--muted)}
.pos-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.pos-btn{padding:10px;text-align:center;background:var(--bg);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-size:.75rem;transition:all .2s}
.pos-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.preview-area{position:relative;background:var(--bg);border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center;min-height:200px}
.preview-area img{max-width:100%;max-height:300px;display:block}
.preview-area canvas{max-width:100%;max-height:300px}
.no-preview{color:var(--dim);font-size:.85rem}
.btn{width:100%;padding:14px;border:none;border-radius:12px;font-size:.95rem;font-weight:600;cursor:pointer;transition:transform .15s,opacity .15s}
.btn:active{transform:scale(.97)}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.btn-secondary{background:var(--card);border:1px solid var(--border);color:var(--text);margin-top:10px}
.btn:disabled{opacity:.4;cursor:not-allowed}
.progress-bar{height:6px;background:var(--border);border-radius:3px;margin-top:12px;overflow:hidden;display:none}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:3px;transition:width .2s}
.status{text-align:center;font-size:.85rem;color:var(--muted);margin-top:8px}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-top:12px}
.gallery-item{position:relative;border-radius:8px;overflow:hidden;aspect-ratio:1;cursor:pointer}
.gallery-item img{width:100%;height:100%;object-fit:cover}
.gallery-item .remove{position:absolute;top:4px;right:4px;width:20px;height:20px;background:rgba(0,0,0,.7);border:none;color:#fff;border-radius:50%;cursor:pointer;font-size:.7rem;display:flex;align-items:center;justify-content:center}
.wm-img-upload{display:flex;align-items:center;gap:10px}
.wm-img-upload .mini-drop{flex:1;border:1px dashed var(--border);border-radius:8px;padding:10px;text-align:center;cursor:pointer;font-size:.8rem;color:var(--muted)}
.wm-img-preview{width:50px;height:50px;border-radius:8px;object-fit:contain;background:var(--bg);border:1px solid var(--border)}
.color-row{display:flex;align-items:center;gap:10px}
.color-row input[type=color]{width:40px;height:34px;border:none;border-radius:6px;cursor:pointer;background:transparent}
.ad-placeholder{background:var(--card);border:1px dashed var(--border);border-radius:var(--radius);padding:30px;text-align:center;color:var(--dim);font-size:.8rem;margin-top:24px}
footer{text-align:center;padding:20px;color:var(--dim);font-size:.8rem;border-top:1px solid var(--border);margin-top:40px}
footer a{color:var(--accent);text-decoration:none}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--green);color:#000;padding:10px 24px;border-radius:10px;font-weight:600;font-size:.9rem;opacity:0;transition:transform .3s,opacity .3s;z-index:99}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
@media(max-width:480px){.container{padding:20px 14px 40px}.row{flex-direction:column}.pos-grid{grid-template-columns:repeat(3,1fr)}}
</style>
</head>
<body>
<div class="top-bar">
<a href="/services/">â† Tools</a>
<button class="lang-btn" onclick="toggleLang()" id="langBtn">EN</button>
</div>
<div class="container">
<h1>ğŸ’§ <span data-i18n="title">ì›Œí„°ë§ˆí¬ ìŠ¤íƒ¬í¼</span></h1>
<p class="subtitle" data-i18n="subtitle">ì´ë¯¸ì§€ì— ì›Œí„°ë§ˆí¬ë¥¼ ì¼ê´„ ì‚½ì…í•˜ì„¸ìš”</p>

<!-- Drop Zone -->
<div class="card">
<div class="drop-zone" id="dropZone" onclick="fileInput.click()">
<div class="icon">ğŸ“</div>
<p data-i18n="drop">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</p>
<p style="font-size:.75rem;color:var(--dim)" data-i18n="dropHint">JPG, PNG, WebP â€” ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥</p>
</div>
<input type="file" id="fileInput" accept="image/*" multiple hidden>
<div class="file-count" id="fileCount"></div>
<div class="gallery" id="gallery"></div>
</div>

<!-- Watermark Type -->
<div class="card">
<h2 data-i18n="wmType">âš™ï¸ ì›Œí„°ë§ˆí¬ ì„¤ì •</h2>
<div class="tabs">
<div class="tab active" onclick="setWmType('text')" id="tabText" data-i18n="textWm">í…ìŠ¤íŠ¸</div>
<div class="tab" onclick="setWmType('image')" id="tabImage" data-i18n="imageWm">ì´ë¯¸ì§€</div>
</div>

<!-- Text Watermark -->
<div id="textPanel">
<div class="form-group">
<label data-i18n="wmText">ì›Œí„°ë§ˆí¬ í…ìŠ¤íŠ¸</label>
<input type="text" id="wmText" value="Â© East Sea" oninput="updatePreview()">
</div>
<div class="row">
<div class="form-group">
<label data-i18n="fontSize">ê¸€ê¼´ í¬ê¸°</label>
<input type="number" id="fontSize" value="32" min="8" max="200" oninput="updatePreview()">
</div>
<div class="form-group">
<label data-i18n="fontColor">ê¸€ê¼´ ìƒ‰ìƒ</label>
<div class="color-row">
<input type="color" id="fontColor" value="#ffffff" oninput="updatePreview()">
<input type="text" id="fontColorHex" value="#ffffff" style="flex:1;padding:8px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:.85rem" oninput="document.getElementById('fontColor').value=this.value;updatePreview()">
</div>
</div>
</div>
<div class="form-group">
<label data-i18n="fontFamily">ê¸€ê¼´</label>
<select id="fontFamily" onchange="updatePreview()">
<option value="Arial, sans-serif">Arial</option>
<option value="'Times New Roman', serif">Times New Roman</option>
<option value="'Courier New', monospace">Courier New</option>
<option value="Georgia, serif">Georgia</option>
<option value="Impact, sans-serif">Impact</option>
<option value="'Noto Sans KR', sans-serif">Noto Sans KR (í•œêµ­ì–´)</option>
</select>
</div>
</div>

<!-- Image Watermark -->
<div id="imagePanel" style="display:none">
<div class="form-group">
<label data-i18n="wmImage">ì›Œí„°ë§ˆí¬ ì´ë¯¸ì§€</label>
<div class="wm-img-upload">
<div class="mini-drop" onclick="wmImgInput.click()" data-i18n="wmImgDrop">ì´ë¯¸ì§€ ì„ íƒ (PNG ê¶Œì¥)</div>
<img id="wmImgPreview" class="wm-img-preview" style="display:none">
</div>
<input type="file" id="wmImgInput" accept="image/*" hidden>
</div>
<div class="form-group">
<label data-i18n="wmScale">ì›Œí„°ë§ˆí¬ í¬ê¸° (%)</label>
<input type="range" id="wmScale" min="5" max="80" value="20" oninput="document.getElementById('scaleVal').textContent=this.value+'%';updatePreview()">
<div class="range-val"><span>5%</span><span id="scaleVal">20%</span><span>80%</span></div>
</div>
</div>

<!-- Common Options -->
<div class="form-group" style="margin-top:16px">
<label data-i18n="opacity">íˆ¬ëª…ë„</label>
<input type="range" id="opacity" min="5" max="100" value="50" oninput="document.getElementById('opVal').textContent=this.value+'%';updatePreview()">
<div class="range-val"><span>5%</span><span id="opVal">50%</span><span>100%</span></div>
</div>
<div class="form-group">
<label data-i18n="rotation">íšŒì „ (Â°)</label>
<input type="range" id="rotation" min="-180" max="180" value="-30" oninput="document.getElementById('rotVal').textContent=this.value+'Â°';updatePreview()">
<div class="range-val"><span>-180Â°</span><span id="rotVal">-30Â°</span><span>180Â°</span></div>
</div>
<div class="form-group">
<label data-i18n="position">ìœ„ì¹˜</label>
<div class="pos-grid">
<div class="pos-btn" onclick="setPos('tl')" data-i18n="posTL">â†– ì¢Œìƒ</div>
<div class="pos-btn" onclick="setPos('tc')" data-i18n="posTC">â†‘ ìƒë‹¨</div>
<div class="pos-btn" onclick="setPos('tr')" data-i18n="posTR">â†— ìš°ìƒ</div>
<div class="pos-btn" onclick="setPos('ml')" data-i18n="posML">â† ì¢Œì¸¡</div>
<div class="pos-btn active" onclick="setPos('mc')" data-i18n="posMC">â— ì¤‘ì•™</div>
<div class="pos-btn" onclick="setPos('mr')" data-i18n="posMR">â†’ ìš°ì¸¡</div>
<div class="pos-btn" onclick="setPos('bl')" data-i18n="posBL">â†™ ì¢Œí•˜</div>
<div class="pos-btn" onclick="setPos('bc')" data-i18n="posBC">â†“ í•˜ë‹¨</div>
<div class="pos-btn" onclick="setPos('br')" data-i18n="posBR">â†˜ ìš°í•˜</div>
</div>
</div>
<div class="form-group">
<label><input type="checkbox" id="tileMode" onchange="updatePreview()"> <span data-i18n="tileMode">íƒ€ì¼ ëª¨ë“œ (ë°˜ë³µ íŒ¨í„´)</span></label>
</div>
</div>

<!-- Preview -->
<div class="card">
<h2 data-i18n="preview">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</h2>
<div class="preview-area" id="previewArea">
<canvas id="previewCanvas" style="display:none"></canvas>
<span class="no-preview" id="noPreview" data-i18n="noPreview">ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤</span>
</div>
</div>

<!-- Actions -->
<button class="btn btn-primary" id="applyBtn" onclick="applyAll()" disabled data-i18n="apply">ğŸ’§ ì›Œí„°ë§ˆí¬ ì ìš© & ë‹¤ìš´ë¡œë“œ</button>
<div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>
<div class="status" id="status"></div>
<button class="btn btn-secondary" onclick="clearAll()" data-i18n="clear">ğŸ—‘ï¸ ëª¨ë‘ ì§€ìš°ê¸°</button>

<div class="ad-placeholder" data-i18n="ad">AD SPACE</div>
</div>

<footer>
<p>Â© 2026 <a href="/">East Sea</a> Â· <a href="/services/">Tools</a> Â· 100% Browser-Based Â· No Upload</p>
</footer>
<div class="toast" id="toast"></div>

<script>
const i18n={
ko:{title:'ì›Œí„°ë§ˆí¬ ìŠ¤íƒ¬í¼',subtitle:'ì´ë¯¸ì§€ì— ì›Œí„°ë§ˆí¬ë¥¼ ì¼ê´„ ì‚½ì…í•˜ì„¸ìš”',drop:'ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ',dropHint:'JPG, PNG, WebP â€” ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥',wmType:'âš™ï¸ ì›Œí„°ë§ˆí¬ ì„¤ì •',textWm:'í…ìŠ¤íŠ¸',imageWm:'ì´ë¯¸ì§€',wmText:'ì›Œí„°ë§ˆí¬ í…ìŠ¤íŠ¸',fontSize:'ê¸€ê¼´ í¬ê¸°',fontColor:'ê¸€ê¼´ ìƒ‰ìƒ',fontFamily:'ê¸€ê¼´',opacity:'íˆ¬ëª…ë„',rotation:'íšŒì „ (Â°)',position:'ìœ„ì¹˜',posTL:'â†– ì¢Œìƒ',posTC:'â†‘ ìƒë‹¨',posTR:'â†— ìš°ìƒ',posML:'â† ì¢Œì¸¡',posMC:'â— ì¤‘ì•™',posMR:'â†’ ìš°ì¸¡',posBL:'â†™ ì¢Œí•˜',posBC:'â†“ í•˜ë‹¨',posBR:'â†˜ ìš°í•˜',tileMode:'íƒ€ì¼ ëª¨ë“œ (ë°˜ë³µ íŒ¨í„´)',preview:'ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°',noPreview:'ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤',apply:'ğŸ’§ ì›Œí„°ë§ˆí¬ ì ìš© & ë‹¤ìš´ë¡œë“œ',clear:'ğŸ—‘ï¸ ëª¨ë‘ ì§€ìš°ê¸°',ad:'ê´‘ê³  ì˜ì—­',wmImage:'ì›Œí„°ë§ˆí¬ ì´ë¯¸ì§€',wmImgDrop:'ì´ë¯¸ì§€ ì„ íƒ (PNG ê¶Œì¥)',wmScale:'ì›Œí„°ë§ˆí¬ í¬ê¸° (%)',fileCount:'{n}ê°œ ì´ë¯¸ì§€ ì„ íƒë¨',processing:'{n}/{t} ì²˜ë¦¬ ì¤‘...',done:'âœ… {n}ê°œ ì™„ë£Œ! ZIP ë‹¤ìš´ë¡œë“œ ì¤‘...'},
en:{title:'Watermark Stamper',subtitle:'Batch-add watermarks to your images',drop:'Drag & drop images or click to select',dropHint:'JPG, PNG, WebP â€” multiple files supported',wmType:'âš™ï¸ Watermark Settings',textWm:'Text',imageWm:'Image',wmText:'Watermark text',fontSize:'Font size',fontColor:'Font color',fontFamily:'Font',opacity:'Opacity',rotation:'Rotation (Â°)',position:'Position',posTL:'â†– Top-L',posTC:'â†‘ Top',posTR:'â†— Top-R',posML:'â† Left',posMC:'â— Center',posMR:'â†’ Right',posBL:'â†™ Bot-L',posBC:'â†“ Bottom',posBR:'â†˜ Bot-R',tileMode:'Tile mode (repeat pattern)',preview:'ğŸ‘ï¸ Preview',noPreview:'Add images to see the preview',apply:'ğŸ’§ Apply Watermark & Download',clear:'ğŸ—‘ï¸ Clear All',ad:'AD SPACE',wmImage:'Watermark image',wmImgDrop:'Select image (PNG recommended)',wmScale:'Watermark size (%)',fileCount:'{n} images selected',processing:'Processing {n}/{t}...',done:'âœ… {n} done! Downloading ZIP...'}
};
let lang='ko',files=[],wmType='text',position='mc',wmImg=null;

function toggleLang(){lang=lang==='ko'?'en':'ko';document.getElementById('langBtn').textContent=lang==='ko'?'EN':'KO';document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');if(i18n[lang][k])el.textContent=i18n[lang][k]});updateFileCount()}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function setWmType(t){wmType=t;document.getElementById('tabText').classList.toggle('active',t==='text');document.getElementById('tabImage').classList.toggle('active',t==='image');document.getElementById('textPanel').style.display=t==='text'?'block':'none';document.getElementById('imagePanel').style.display=t==='image'?'block':'none';updatePreview()}
function setPos(p){position=p;document.querySelectorAll('.pos-btn').forEach((b,i)=>{const ps=['tl','tc','tr','ml','mc','mr','bl','bc','br'];b.classList.toggle('active',ps[i]===p)});updatePreview()}

// File handling
const dropZone=document.getElementById('dropZone'),fileInput=document.getElementById('fileInput');
dropZone.addEventListener('dragover',e=>{e.preventDefault();dropZone.classList.add('over')});
dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('over'));
dropZone.addEventListener('drop',e=>{e.preventDefault();dropZone.classList.remove('over');addFiles(e.dataTransfer.files)});
fileInput.addEventListener('change',e=>addFiles(e.target.files));
document.getElementById('wmImgInput').addEventListener('change',e=>{
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();r.onload=ev=>{
    const img=new Image();img.onload=()=>{wmImg=img;document.getElementById('wmImgPreview').src=ev.target.result;document.getElementById('wmImgPreview').style.display='block';updatePreview()};
    img.src=ev.target.result};r.readAsDataURL(f)});

function addFiles(fl){
  for(const f of fl){if(!f.type.startsWith('image/'))continue;files.push(f)}
  updateFileCount();renderGallery();if(files.length>0)updatePreview();
  document.getElementById('applyBtn').disabled=files.length===0}
function updateFileCount(){
  const el=document.getElementById('fileCount');
  if(files.length===0){el.textContent='';return}
  el.textContent=i18n[lang].fileCount.replace('{n}',files.length)}
function renderGallery(){
  const g=document.getElementById('gallery');g.innerHTML='';
  files.forEach((f,i)=>{const d=document.createElement('div');d.className='gallery-item';
    const img=document.createElement('img');const url=URL.createObjectURL(f);img.src=url;
    const rm=document.createElement('button');rm.className='remove';rm.textContent='Ã—';rm.onclick=e=>{e.stopPropagation();files.splice(i,1);renderGallery();updateFileCount();updatePreview();document.getElementById('applyBtn').disabled=files.length===0};
    d.appendChild(img);d.appendChild(rm);g.appendChild(d)})}
function clearAll(){files=[];renderGallery();updateFileCount();document.getElementById('applyBtn').disabled=true;
  const c=document.getElementById('previewCanvas');c.style.display='none';document.getElementById('noPreview').style.display='block';
  document.getElementById('status').textContent='';document.getElementById('progressBar').style.display='none'}

// Preview
function updatePreview(){
  if(files.length===0)return;
  const reader=new FileReader();
  reader.onload=e=>{const img=new Image();img.onload=()=>{drawWatermark(img,true)};img.src=e.target.result};
  reader.readAsDataURL(files[0])}

function drawWatermark(img,isPreview,canvas){
  const c=canvas||document.getElementById('previewCanvas');
  const ctx=c.getContext('2d');
  c.width=img.width;c.height=img.height;
  ctx.drawImage(img,0,0);
  const opacity=parseInt(document.getElementById('opacity').value)/100;
  const rot=parseInt(document.getElementById('rotation').value)*Math.PI/180;
  const tile=document.getElementById('tileMode').checked;
  ctx.globalAlpha=opacity;

  if(wmType==='text'){
    const text=document.getElementById('wmText').value||'Watermark';
    const size=parseInt(document.getElementById('fontSize').value);
    const color=document.getElementById('fontColor').value;
    const font=document.getElementById('fontFamily').value;
    const scaledSize=Math.round(size*(img.width/800));
    ctx.font=`${scaledSize}px ${font}`;ctx.fillStyle=color;
    const m=ctx.measureText(text);const tw=m.width;const th=scaledSize;
    if(tile){
      const gap=tw*1.5;const gapY=th*3;
      for(let y=-img.height;y<img.height*2;y+=gapY){
        for(let x=-img.width;x<img.width*2;x+=gap){
          ctx.save();ctx.translate(x,y);ctx.rotate(rot);ctx.fillText(text,0,0);ctx.restore()}}
    }else{
      const [px,py]=getPos(img.width,img.height,tw,th);
      ctx.save();ctx.translate(px+tw/2,py+th/2);ctx.rotate(rot);ctx.fillText(text,-tw/2,th/4);ctx.restore()}
  }else if(wmType==='image'&&wmImg){
    const scale=parseInt(document.getElementById('wmScale').value)/100;
    const ww=img.width*scale;const wh=wmImg.height*(ww/wmImg.width);
    if(tile){
      const gap=ww*1.5;const gapY=wh*1.5;
      for(let y=-img.height;y<img.height*2;y+=gapY){
        for(let x=-img.width;x<img.width*2;x+=gap){
          ctx.save();ctx.translate(x+ww/2,y+wh/2);ctx.rotate(rot);ctx.drawImage(wmImg,-ww/2,-wh/2,ww,wh);ctx.restore()}}
    }else{
      const [px,py]=getPos(img.width,img.height,ww,wh);
      ctx.save();ctx.translate(px+ww/2,py+wh/2);ctx.rotate(rot);ctx.drawImage(wmImg,-ww/2,-wh/2,ww,wh);ctx.restore()}}
  ctx.globalAlpha=1;
  if(isPreview){c.style.display='block';document.getElementById('noPreview').style.display='none'}
  return c}

function getPos(cw,ch,w,h){
  const pad=20;const m={tl:[pad,pad],tc:[(cw-w)/2,pad],tr:[cw-w-pad,pad],ml:[pad,(ch-h)/2],mc:[(cw-w)/2,(ch-h)/2],mr:[cw-w-pad,(ch-h)/2],bl:[pad,ch-h-pad],bc:[(cw-w)/2,ch-h-pad],br:[cw-w-pad,ch-h-pad]};
  return m[position]||m.mc}

// Apply to all
async function applyAll(){
  if(files.length===0)return;
  const pb=document.getElementById('progressBar');const pf=document.getElementById('progressFill');
  const st=document.getElementById('status');
  pb.style.display='block';pf.style.width='0%';
  const results=[];
  for(let i=0;i<files.length;i++){
    st.textContent=i18n[lang].processing.replace('{n}',i+1).replace('{t}',files.length);
    pf.style.width=((i+1)/files.length*100)+'%';
    const img=await loadImage(files[i]);
    const c=document.createElement('canvas');
    drawWatermark(img,false,c);
    const blob=await new Promise(r=>c.toBlob(r,'image/png'));
    results.push({name:'wm_'+files[i].name.replace(/\.[^.]+$/,'.png'),blob})}
  if(results.length===1){
    downloadBlob(results[0].blob,results[0].name)}
  else{
    const zip=await createZip(results);downloadBlob(zip,'watermarked_images.zip')}
  st.textContent=i18n[lang].done.replace('{n}',results.length);
  toast(i18n[lang].done.replace('{n}',results.length))}

function loadImage(file){return new Promise(r=>{const fr=new FileReader();fr.onload=e=>{const img=new Image();img.onload=()=>r(img);img.src=e.target.result};fr.readAsDataURL(file)})}
function downloadBlob(blob,name){const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=name;a.click();URL.revokeObjectURL(a.href)}

// Simple ZIP implementation (no dependencies)
async function createZip(files){
  const enc=new TextEncoder();
  const parts=[];const centralDir=[];let offset=0;
  for(const f of files){
    const nameBytes=enc.encode(f.name);const data=new Uint8Array(await f.blob.arrayBuffer());
    const crc=crc32(data);
    // Local file header
    const local=new Uint8Array(30+nameBytes.length);const lv=new DataView(local.buffer);
    lv.setUint32(0,0x04034b50,true);lv.setUint16(4,20,true);lv.setUint16(8,0,true);
    lv.setUint32(14,crc,true);lv.setUint32(18,data.length,true);lv.setUint32(22,data.length,true);
    lv.setUint16(26,nameBytes.length,true);local.set(nameBytes,30);
    // Central directory entry
    const cde=new Uint8Array(46+nameBytes.length);const cv=new DataView(cde.buffer);
    cv.setUint32(0,0x02014b50,true);cv.setUint16(4,20,true);cv.setUint16(6,20,true);
    cv.setUint32(16,crc,true);cv.setUint32(20,data.length,true);cv.setUint32(24,data.length,true);
    cv.setUint16(28,nameBytes.length,true);cv.setUint32(42,offset,true);cde.set(nameBytes,46);
    parts.push(local,data);centralDir.push(cde);offset+=local.length+data.length}
  const cdOffset=offset;let cdSize=0;centralDir.forEach(c=>cdSize+=c.length);
  const eocd=new Uint8Array(22);const ev=new DataView(eocd.buffer);
  ev.setUint32(0,0x06054b50,true);ev.setUint16(8,files.length,true);ev.setUint16(10,files.length,true);
  ev.setUint32(12,cdSize,true);ev.setUint32(16,cdOffset,true);
  return new Blob([...parts,...centralDir,eocd],{type:'application/zip'})}

function crc32(data){
  let c=0xFFFFFFFF;const t=new Uint32Array(256);
  for(let n=0;n<256;n++){let k=n;for(let j=0;j<8;j++)k=k&1?0xEDB88320^(k>>>1):k>>>1;t[n]=k}
  for(let i=0;i<data.length;i++)c=t[(c^data[i])&0xFF]^(c>>>8);
  return (c^0xFFFFFFFF)>>>0}

// Color input sync
document.getElementById('fontColor').addEventListener('input',function(){document.getElementById('fontColorHex').value=this.value});
</script>
</body>
</html>
